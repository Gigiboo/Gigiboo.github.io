

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Gigiboo">
  <meta name="keywords" content="">
  
    <meta name="description" content="单片机第一部分">
<meta property="og:type" content="article">
<meta property="og:title" content="单片机入门学习1">
<meta property="og:url" content="http://gigiboo.github.io/2023/02/14/%E5%8D%95%E7%89%87%E6%9C%BA1/index.html">
<meta property="og:site_name" content="Gigiboo&#39;s Blog">
<meta property="og:description" content="单片机第一部分">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://gigiboo.github.io/img/123.jpg">
<meta property="article:published_time" content="2023-02-14T12:32:54.000Z">
<meta property="article:modified_time" content="2023-02-14T13:11:14.094Z">
<meta property="article:author" content="Gigiboo">
<meta property="article:tag" content="51单片机">
<meta property="article:tag" content="Keil">
<meta property="article:tag" content="C语言">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://gigiboo.github.io/img/123.jpg">
  
  
  
  <title>单片机入门学习1 - Gigiboo&#39;s Blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  



  
<link rel="stylesheet" href="/css/mac.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"gigiboo.github.io","root":"/","version":"1.9.2","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"ra4xihMhcfwkWbMdTMjyDNPb-gzGzoHsz","app_key":"o45ESI4r0dA0j3hGdyDaiMsn","server_url":"https://ra4xihmh.lc-cn-n1-shared.com","path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  

  

  

  

  

  
    
  



  
<meta name="generator" content="Hexo 5.4.2"><script src="/assets/js/DPlayer.min.js"></script></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Gigiboo&#39;s Blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                友链
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/1.jpeg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="单片机入门学习1"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-02-14 20:32" pubdate>
          2023年2月14日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          30k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          251 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">单片机入门学习1</h1>
            
            
              <div class="markdown-body">
                
                <h1>51单片机入门学习记录（1）</h1>
<p>教程：江科协</p>
<blockquote>
<p>目录：</p>
<p>[LED](#1.4 LED)</p>
<p>[独立按键](#1.5 独立按键)</p>
<p>[数码管](#1.10 数码管)</p>
<p><a href="#1.11%E6%A8%A1%E5%9D%97%E5%8C%96%E7%BC%96%E7%A8%8B">模块化编程</a></p>
<p>[矩阵键盘](#1.12 矩阵键盘)</p>
<p>[定时器](#1.14 定时器)</p>
<p>[串口](#1.18 串口)</p>
</blockquote>
<h3 id="1-1">1.1</h3>
<p>安装kail和stc-isp 买了块板子</p>
<p>1-2视频<strong>还没有连接板子</strong>（板子刚下单</p>
<h3 id="1-4-LED">1.4 LED</h3>
<p>AT89C52！！！</p>
<p>单片机到了 连接串口安装驱动程序CH341ser 一开始一直显示预安装 搜了很多帖子也没找到解决方案</p>
<p>在等官方客服回复中摸鱼了会 一个小时后再次回来连接惊喜的连接成功了</p>
<blockquote>
<p>1.12回顾：应该是usb线没有连接好的问题，后续很多时候都是正常的，只有在usb未完全插入电脑的时候会提示检测未知</p>
</blockquote>
<p>听了很多的硬件内部介绍 听不懂</p>
<p>要照明第一个LED灯：</p>
<h4 id="点亮第一个LED">点亮第一个LED</h4>
<p><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/image-20230104210911586.png" srcset="/img/loading.gif" lazyload alt="image-20230104210911586"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">P2 = <span class="hljs-number">1111</span> <span class="hljs-number">1110</span><br></code></pre></td></tr></table></figure>
<p>0赋给P20口（最低位）——操作LED 写代码的时候要转化为十进制或者十六进制</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">P2=<span class="hljs-number">0xFE</span> <span class="hljs-comment">//1111 1110</span><br></code></pre></td></tr></table></figure>
<p>代码下载入单片机中 如下操作：</p>
<p><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/image-20230104210631295.png" srcset="/img/loading.gif" lazyload alt="image-20230104210631295"></p>
<p><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/image-20230104210749530.png" srcset="/img/loading.gif" lazyload alt="image-20230104210749530"></p>
<p>但是P2命令会一直被执行 我们需要让他持续 而不是重复执行命令</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;REGX52.H&gt;</span></span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br>	P2=<span class="hljs-number">0xFE</span>; <span class="hljs-comment">//1111 1110</span><br>	<span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)&#123;<br>		<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="亮不同的灯：">亮不同的灯：</h4>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;REGX52.H&gt;</span></span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br>	P2 = <span class="hljs-number">0xFE</span>; <span class="hljs-number">1111</span> <span class="hljs-number">1110</span><br>	P2=<span class="hljs-number">0xA5</span>;<span class="hljs-comment">//1010 0101</span><br>	<span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)&#123;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="以1s为周期闪烁">以1s为周期闪烁</h4>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;REGX52.H&gt;</span></span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br><br>	<span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)&#123;<br>		P2 = <span class="hljs-number">0xFE</span>;<br>		P2 = <span class="hljs-number">0xFF</span>;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>此时单片机并没有按预期闪烁 而是减小了亮度 原因为单片机的速度是Mhz 速度很快 肉眼无法分辨</p>
<p>所以我们需要在两个代码里执行一定的延时</p>
<p><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/image-20230104212517191.png" srcset="/img/loading.gif" lazyload alt="image-20230104212517191"></p>
<p>这里选错了 应该选毫秒…</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;REGX52.H&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;INTRINS.H&gt;</span></span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">Delay500ms</span><span class="hljs-params">()</span>		<span class="hljs-comment">//@12.000MHz</span><br>&#123;<br>	<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> i, j, k;<br><br>	_nop_();<br>	i = <span class="hljs-number">4</span>;<br>	j = <span class="hljs-number">205</span>;<br>	k = <span class="hljs-number">187</span>;<br>	<span class="hljs-keyword">do</span><br>	&#123;<br>		<span class="hljs-keyword">do</span><br>		&#123;<br>			<span class="hljs-keyword">while</span> (--k);<br>		&#125; <span class="hljs-keyword">while</span> (--j);<br>	&#125; <span class="hljs-keyword">while</span> (--i);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br><br>	<span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)&#123;<br>		P2 = <span class="hljs-number">0xFE</span>;<br>		Delay500ms();	<br>		P2 = <span class="hljs-number">0xFF</span>;<br>		Delay500ms();	<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>成功咯！</p>
<h4 id="LED流水灯">LED流水灯</h4>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;REGX52.H&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;INTRINS.H&gt;</span></span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">Delay500ms</span><span class="hljs-params">()</span>		<span class="hljs-comment">//@12.000MHz</span><br>&#123;<br>	<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> i, j, k;<br><br>	_nop_();<br>	i = <span class="hljs-number">4</span>;<br>	j = <span class="hljs-number">205</span>;<br>	k = <span class="hljs-number">187</span>;<br>	<span class="hljs-keyword">do</span><br>	&#123;<br>		<span class="hljs-keyword">do</span><br>		&#123;<br>			<span class="hljs-keyword">while</span> (--k);<br>		&#125; <span class="hljs-keyword">while</span> (--j);<br>	&#125; <span class="hljs-keyword">while</span> (--i);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br>	<span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)&#123;<br>		P2 = <span class="hljs-number">0xFE</span>;<span class="hljs-comment">//1111 1110</span><br>		Delay500ms();<br>		P2 = <span class="hljs-number">0xFD</span>;<span class="hljs-comment">//1111 1101</span><br>		Delay500ms();<br>		P2 = <span class="hljs-number">0xFB</span>;<span class="hljs-comment">//1111 1011</span><br>		Delay500ms();<br>		P2 = <span class="hljs-number">0xF7</span>;<span class="hljs-comment">//1111 0111</span><br>		Delay500ms();<br>		P2 = <span class="hljs-number">0xEF</span>;<span class="hljs-comment">//1110 1111</span><br>		Delay500ms();<br>		P2 = <span class="hljs-number">0xDF</span>;<span class="hljs-comment">//1101 1111</span><br>		Delay500ms();<br>		P2 = <span class="hljs-number">0xBF</span>;<span class="hljs-comment">//1011 1111</span><br>		Delay500ms();<br>		P2 = <span class="hljs-number">0x7F</span>;<span class="hljs-comment">//0111 1111</span><br>		Delay500ms();<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>以200ms为变化间隔 实现</p>
<h3 id="1-5-独立按键">1.5 独立按键</h3>
<h4 id="独立按键">独立按键</h4>
<h5 id="按下点亮-弹起熄灭">按下点亮 弹起熄灭</h5>
<p>电子开关 按下时接通 送开始断开 通过内部的金属弹片受力弹动</p>
<p>按下为低电平（与GND相连）</p>
<p><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/image-20230105112118646.png" srcset="/img/loading.gif" lazyload alt="image-20230105112118646"></p>
<p>源代码 <code>P2 = 0xFE;</code>要同时给八个赋值 只想操控最低位</p>
<p><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/image-20230105113023929.png" srcset="/img/loading.gif" lazyload alt="image-20230105113023929"></p>
<p><code>sbit</code>可以操纵位寄存器</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;REGX52.H&gt;</span></span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br><span class="hljs-comment">//	P2 = 0xFE;</span><br>	P2_0 = <span class="hljs-number">0</span>;<br>	<span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)&#123;<br>		<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>要实现电子元件控制：</p>
<p>注意 K1和K2 的接脚不是按照顺序 K1是接在P3_1的口上</p>
<p><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/image-20230105114234639.png" srcset="/img/loading.gif" lazyload alt="image-20230105114234639"></p>
<p><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/image-20230105114319582.png" srcset="/img/loading.gif" lazyload alt="image-20230105114319582"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;REGX52.H&gt;</span></span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br><br>	<span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)&#123;<br>		<span class="hljs-keyword">if</span>(P3_1 == <span class="hljs-number">0</span>)&#123;<span class="hljs-comment">//按下K1</span><br>			P2_0 = <span class="hljs-number">0</span>;<span class="hljs-comment">//点亮LED1</span><br>		&#125;<br>		<span class="hljs-keyword">else</span>&#123;<br>			P2_0 = <span class="hljs-number">1</span>;<span class="hljs-comment">//熄灭LED1</span><br>		&#125;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="按键的抖动">按键的抖动</h4>
<p>由于机械触点的弹性作用，一个开关在闭合时不会马上稳定地连接，在断开时也不会一下子断开，所以在开关闭合及断开的瞬间会伴随一连串的抖动</p>
<p><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/image-20230105122610824.png" srcset="/img/loading.gif" lazyload alt="image-20230105122610824"></p>
<p>实现<strong>按键的消抖</strong>：硬件的过滤、软件程序处理(检测)</p>
<p>以及<strong>检测松手</strong></p>
<h5 id="按下弹起一个周期后在执行命令">按下弹起一个周期后在执行命令</h5>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;REGX52.H&gt;</span></span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">Delay</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> xms)</span>		<span class="hljs-comment">//@12.000MHz</span><br>&#123;<br>	<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> i, j;<br>	<span class="hljs-keyword">while</span>(xms--)&#123;<br>		i = <span class="hljs-number">2</span>;<br>		j = <span class="hljs-number">239</span>;<br>		<span class="hljs-keyword">do</span><br>		&#123;<br>			<span class="hljs-keyword">while</span> (--j);<br>		&#125; <span class="hljs-keyword">while</span> (--i);<br>	&#125;<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br>	<span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)&#123;<br>		<span class="hljs-keyword">if</span>(P3_1==<span class="hljs-number">0</span>)&#123;<br>			Delay(<span class="hljs-number">20</span>);<span class="hljs-comment">//过滤按下抖动</span><br>			<span class="hljs-keyword">while</span>(P3_1==<span class="hljs-number">0</span>);<span class="hljs-comment">//检测松手</span><br>			Delay(<span class="hljs-number">20</span>);<span class="hljs-comment">//过滤松开抖动</span><br>			<br>			P2_0 =~P2_0;<br>		&#125;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>但是刚刚不小心打成了<code>P3_0==0</code> 灯是按下后不停闪烁 其实这是一个无效语句 真正实现的内核是：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br>	<span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)&#123;<br>		<span class="hljs-keyword">if</span>(P3_1==<span class="hljs-number">0</span>)&#123;<br>			Delay(<span class="hljs-number">20</span>);<span class="hljs-comment">//过滤按下抖动</span><br>			Delay(<span class="hljs-number">20</span>);<span class="hljs-comment">//过滤松开抖动</span><br>			<br>			P2_0 =~P2_0;<br>		&#125;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>只要按下P2_0会不停地取反 灯就不停地闪烁</p>
<h4 id="独立按键控制LED显示二进制">独立按键控制LED显示二进制</h4>
<p>P2上电默认都是高电平</p>
<p>方案一：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;REGX52.H&gt;</span></span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">Delay</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> xms)</span>		<span class="hljs-comment">//@12.000MHz</span><br>&#123;<br>	<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> i, j;<br>	<span class="hljs-keyword">while</span>(xms--)&#123;<br>		i = <span class="hljs-number">2</span>;<br>		j = <span class="hljs-number">239</span>;<br>		<span class="hljs-keyword">do</span><br>		&#123;<br>			<span class="hljs-keyword">while</span> (--j);<br>		&#125; <span class="hljs-keyword">while</span> (--i);<br>	&#125;<br>&#125;<br><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br>	<span class="hljs-comment">//unsigned char LEDnumber;</span><br>	<span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)&#123;<br>		<span class="hljs-keyword">if</span>(P3_1==<span class="hljs-number">0</span>)&#123;<br>			Delay(<span class="hljs-number">20</span>);<br>			<span class="hljs-keyword">while</span>(P3_1==<span class="hljs-number">0</span>);<br>			Delay(<span class="hljs-number">20</span>);<br>			<br><br>			P2--;<br>		&#125;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>方案二：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;REGX52.H&gt;</span></span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">Delay</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> xms)</span>		<span class="hljs-comment">//@12.000MHz</span><br>&#123;<br>	<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> i, j;<br>	<span class="hljs-keyword">while</span>(xms--)&#123;<br>		i = <span class="hljs-number">2</span>;<br>		j = <span class="hljs-number">239</span>;<br>		<span class="hljs-keyword">do</span><br>		&#123;<br>			<span class="hljs-keyword">while</span> (--j);<br>		&#125; <span class="hljs-keyword">while</span> (--i);<br>	&#125;<br>&#125;<br><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br>	<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> LEDnumber=<span class="hljs-number">0</span>;<span class="hljs-comment">//一般用unsigned char表示寄存器（八位）</span><br>	<span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)&#123;<br>		<span class="hljs-keyword">if</span>(P3_1==<span class="hljs-number">0</span>)&#123;<br>			Delay(<span class="hljs-number">20</span>);<br>			<span class="hljs-keyword">while</span>(P3_1==<span class="hljs-number">0</span>);<br>			Delay(<span class="hljs-number">20</span>);<br>			<br>			<span class="hljs-comment">//P2--;</span><br>			LEDnumber++;<br>			P2 =~LEDnumber;<br>		&#125;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<div id="dplayer0" class="dplayer hexo-tag-dplayer-mark" style="margin-bottom: 20px;"></div><script>(function(){var player = new DPlayer({"container":document.getElementById("dplayer0"),"autoplay":true,"hotkey":true,"preload":"metadata","video":{"url":"https://typoraxmy.oss-cn-shanghai.aliyuncs.com/5dfb3c51218fff758a5c580a78f3545f.mp4"}});window.dplayers||(window.dplayers=[]);window.dplayers.push(player);})()</script> 
<h4 id="独立按键控制LED移位">独立按键控制LED移位</h4>
<h5 id="一个开关左右移动">一个开关左右移动</h5>
<p>原本想要更简洁一些</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br>	P2 = ~<span class="hljs-number">0x01</span>;<br>	<span class="hljs-type">int</span> i;<br>	<span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)&#123;<br>		<span class="hljs-keyword">if</span>(P3_1==<span class="hljs-number">0</span>)&#123;<br>			Delay(<span class="hljs-number">20</span>);<br>			<span class="hljs-keyword">while</span>(P3_1==<span class="hljs-number">0</span>);<br>			Delay(<span class="hljs-number">20</span>);		<br>		&#125;<br>		<br>		<span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">8</span>;i++)&#123;<br>			P2=~(<span class="hljs-number">0x01</span>&lt;&lt;i);<br>		&#125;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>发现运行后 LED全灯都是小亮度亮的 只有最后一个灯在按下按钮的时候是常亮的 发现是在一次while循环里 立马就执行了移位 延时函数失效</p>
<p>修改程序</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;REGX52.H&gt;</span></span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">Delay</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> xms)</span>		<span class="hljs-comment">//@12.000MHz</span><br>&#123;<br>	<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> i, j;<br>	<span class="hljs-keyword">while</span>(xms--)&#123;<br>		i = <span class="hljs-number">2</span>;<br>		j = <span class="hljs-number">239</span>;<br>		<span class="hljs-keyword">do</span><br>		&#123;<br>			<span class="hljs-keyword">while</span> (--j);<br>		&#125; <span class="hljs-keyword">while</span> (--i);<br>	&#125;<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br>	<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> LEDnumber;<br>	P2 =~<span class="hljs-number">0x01</span>;<br>	<span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)&#123;<br>		<span class="hljs-keyword">if</span>(P3_1==<span class="hljs-number">0</span>)&#123;<br>			Delay(<span class="hljs-number">20</span>);<br>			<span class="hljs-keyword">while</span>(P3_1==<span class="hljs-number">0</span>);<br>			Delay(<span class="hljs-number">20</span>);<br>			<br>			LEDnumber++;<br>			<span class="hljs-keyword">if</span>(LEDnumber&gt;=<span class="hljs-number">8</span>)&#123;<br>				LEDnumber=<span class="hljs-number">0</span>;<br>			&#125;<br>			P2=~(<span class="hljs-number">0x01</span>&lt;&lt;LEDnumber);<br>		&#125;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h5 id="实现两个开关左右移动：">实现两个开关左右移动：</h5>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;REGX52.H&gt;</span></span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">Delay</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> xms)</span>		<span class="hljs-comment">//@12.000MHz</span><br>&#123;<br>	<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> i, j;<br>	<span class="hljs-keyword">while</span>(xms--)&#123;<br>		i = <span class="hljs-number">2</span>;<br>		j = <span class="hljs-number">239</span>;<br>		<span class="hljs-keyword">do</span><br>		&#123;<br>			<span class="hljs-keyword">while</span> (--j);<br>		&#125; <span class="hljs-keyword">while</span> (--i);<br>	&#125;<br>&#125;<br><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> LEDnumber;<span class="hljs-comment">//最好定义全局变量</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br>	P2 =~<span class="hljs-number">0x01</span>;<br>	<span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)&#123;<span class="hljs-comment">//右移动</span><br>		<span class="hljs-keyword">if</span>(P3_1==<span class="hljs-number">0</span>)&#123;<br>			Delay(<span class="hljs-number">20</span>);<br>			<span class="hljs-keyword">while</span>(P3_1==<span class="hljs-number">0</span>);<br>			Delay(<span class="hljs-number">20</span>);<br>			<br>			LEDnumber++;<br>			<span class="hljs-keyword">if</span>(LEDnumber&gt;=<span class="hljs-number">8</span>)&#123;<br>				LEDnumber=<span class="hljs-number">0</span>;<br>			&#125;<br>			P2=~(<span class="hljs-number">0x01</span>&lt;&lt;LEDnumber);<br>		&#125;<br>		<span class="hljs-keyword">if</span>(P3_0==<span class="hljs-number">0</span>)&#123;<span class="hljs-comment">//左移动</span><br>			Delay(<span class="hljs-number">20</span>);<br>			<span class="hljs-keyword">while</span>(P3_0==<span class="hljs-number">0</span>);<br>			Delay(<span class="hljs-number">20</span>);<br>			<span class="hljs-keyword">if</span>(LEDnumber==<span class="hljs-number">0</span>)&#123;<br>				LEDnumber = <span class="hljs-number">7</span>;<br>			&#125;<br>			<span class="hljs-keyword">else</span>&#123;<br>				LEDnumber--;<br>			&#125;<br>			P2=~(<span class="hljs-number">0x01</span>&lt;&lt;LEDnumber);<br>		&#125;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>呜呜呜还是有很多代码的小细节要注意的</p>
<div id="dplayer1" class="dplayer hexo-tag-dplayer-mark" style="margin-bottom: 20px;"></div><script>(function(){var player = new DPlayer({"container":document.getElementById("dplayer1"),"autoplay":true,"hotkey":true,"preload":"metadata","video":{"url":"https://typoraxmy.oss-cn-shanghai.aliyuncs.com/cbbe1197e3efe2408008da36b4c8aadf.mp4"}});window.dplayers||(window.dplayers=[]);window.dplayers.push(player);})()</script> 
<p>注意：<code>unsigned char LEDnumber;//最好定义全局变量</code>默认是0 在main里定义可能不是0 在初始定义时好像不能赋初始值 会报错 呜呜呜已经把这些细碎知识点忘光了</p>
<h3 id="1-10-数码管">1.10 数码管</h3>
<p>数码管：多个发光二极管封装在一起组成“ 8 ”字型的器件</p>
<h4 id="在数码管上任意位置显示任意数据（静态显示）">在数码管上任意位置显示任意数据（静态显示）</h4>
<h4 id=""></h4>
<h4 id="image-20230110195522620"><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/image-20230110195522620.png" srcset="/img/loading.gif" lazyload alt="image-20230110195522620"></h4>
<p>引脚就近原则</p>
<p>要点亮一个数字 以“6”为例子</p>
<p><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/%E6%97%A0%E6%A0%87%E9%A2%98.jpg" srcset="/img/loading.gif" lazyload alt="无标题"></p>
<p>开发板上有两个四位一体的数码管</p>
<p><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/1.png" srcset="/img/loading.gif" lazyload alt="1"></p>
<p>138编码器</p>
<p><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/134.png" srcset="/img/loading.gif" lazyload alt="134"></p>
<p>注意Y<code>0</code>对应LED<code>1</code>（有错位）</p>
<p>数码管</p>
<p><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/%E5%98%BF%E5%98%BF.png" srcset="/img/loading.gif" lazyload alt="嘿嘿"></p>
<p><code>74HC254</code>是一个双向数据缓冲，为了提高单片机的负载能力 （能够带动很多LED灯）</p>
<p>当<code>DIR</code>（连接<code>LE</code>）的输入为高电平时，从左向右缓冲数据，反之，从右向左读取数据</p>
<p>而左边部分与138编码器相连接，目的是为了使得单片机提供的为控制信号，缓冲到右边，由电源VCC直接提供能量控制LED灯</p>
<p>主要是因为<strong>高电平驱动能力弱</strong>（低电平驱动能力强）</p>
<p>使某一位显示一个数据：</p>
<p><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/111111111222222222333333333333.png" srcset="/img/loading.gif" lazyload alt="111111111222222222333333333333"></p>
<p>以LED6显示6为例</p>
<p><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/123.png" srcset="/img/loading.gif" lazyload alt="123"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;REGX52.H&gt;</span></span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br>	P2_4 = <span class="hljs-number">1</span>;<br>	P2_3 = <span class="hljs-number">0</span>;<br>	P2_2 = <span class="hljs-number">1</span>;<br>	P0 = <span class="hljs-number">0x7D</span>;<br>	<span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)&#123;<br>		<br>	&#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>
<p><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/07a4e4660eb9751ed31e6b99baeaf86.jpg" srcset="/img/loading.gif" lazyload alt="07a4e4660eb9751ed31e6b99baeaf86"></p>
<p>LED模块因为引脚冲突所以也会亮</p>
<p>把数码管的某一位显示某一个数字进行封装，抽取出变成<strong>子函数</strong>以达到代码的复用和优化程序结构的目的</p>
<p>参数：<strong>位置</strong>、<strong>数字</strong></p>
<p>一般用<strong>数组</strong>显示<strong>段码</strong></p>
<p>段码表:</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">0</span>  <span class="hljs-number">1</span>  <span class="hljs-number">2</span>  <span class="hljs-number">3</span>  <span class="hljs-number">4</span>  <span class="hljs-number">5</span>  <span class="hljs-number">6</span>  <span class="hljs-number">7</span>  <span class="hljs-number">8</span>  <span class="hljs-number">9</span>  <br><br><span class="hljs-attribute">0x3F</span>,<span class="hljs-number">0</span>x06,<span class="hljs-number">0</span>x5B,<span class="hljs-number">0</span>x4F,<span class="hljs-number">0</span>x66,<span class="hljs-number">0</span>x6D,<span class="hljs-number">0</span>x7D,<span class="hljs-number">0</span>x07,<span class="hljs-number">0</span>x7F,<span class="hljs-number">0</span>x6F,<br></code></pre></td></tr></table></figure>
<p>优化程序结构：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;REGX52.H&gt;</span></span><br><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> NixieTable[] = &#123;<span class="hljs-number">0x3F</span>,<span class="hljs-number">0x06</span>,<span class="hljs-number">0x5B</span>,<span class="hljs-number">0x4F</span>,<span class="hljs-number">0x66</span>,<span class="hljs-number">0x6D</span>,<span class="hljs-number">0x7D</span>,<span class="hljs-number">0x07</span>,<span class="hljs-number">0x7F</span>,<span class="hljs-number">0x6F</span>&#125;;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">Nixie</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> location,number)</span>&#123;<br>	<span class="hljs-keyword">switch</span>(location)&#123;<br>		<span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:P2_4=<span class="hljs-number">1</span>;P2_3=<span class="hljs-number">1</span>;P2_2=<span class="hljs-number">1</span>;<span class="hljs-keyword">break</span>;<br>		<span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:P2_4=<span class="hljs-number">1</span>;P2_3=<span class="hljs-number">1</span>;P2_2=<span class="hljs-number">0</span>;<span class="hljs-keyword">break</span>;<br>		<span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:P2_4=<span class="hljs-number">1</span>;P2_3=<span class="hljs-number">0</span>;P2_2=<span class="hljs-number">1</span>;<span class="hljs-keyword">break</span>;<br>		<span class="hljs-keyword">case</span> <span class="hljs-number">4</span>:P2_4=<span class="hljs-number">1</span>;P2_3=<span class="hljs-number">0</span>;P2_2=<span class="hljs-number">0</span>;<span class="hljs-keyword">break</span>;<br>		<span class="hljs-keyword">case</span> <span class="hljs-number">5</span>:P2_4=<span class="hljs-number">0</span>;P2_3=<span class="hljs-number">1</span>;P2_2=<span class="hljs-number">1</span>;<span class="hljs-keyword">break</span>;<br>		<span class="hljs-keyword">case</span> <span class="hljs-number">6</span>:P2_4=<span class="hljs-number">0</span>;P2_3=<span class="hljs-number">1</span>;P2_2=<span class="hljs-number">0</span>;<span class="hljs-keyword">break</span>;<br>		<span class="hljs-keyword">case</span> <span class="hljs-number">7</span>:P2_4=<span class="hljs-number">0</span>;P2_3=<span class="hljs-number">0</span>;P2_2=<span class="hljs-number">1</span>;<span class="hljs-keyword">break</span>;<br>		<span class="hljs-keyword">case</span> <span class="hljs-number">8</span>:P2_4=<span class="hljs-number">0</span>;P2_3=<span class="hljs-number">0</span>;P2_2=<span class="hljs-number">0</span>;<span class="hljs-keyword">break</span>;<br>	&#125;<br>	P0 = NixieTable[number];<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br>	Nixie(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>);<br>	<span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)&#123;<br>		<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/image-20230110215647695.png" srcset="/img/loading.gif" lazyload alt="image-20230110215647695"></p>
<h4 id="数码管的动态显示-任意位置-多显示（动态扫描）">数码管的动态显示 任意位置 多显示（动态扫描）</h4>
<p>不断地扫描</p>
<p>不添加延时的话会出现这样的情况：</p>
<div id="dplayer2" class="dplayer hexo-tag-dplayer-mark" style="margin-bottom: 20px;"></div><script>(function(){var player = new DPlayer({"container":document.getElementById("dplayer2"),"autoplay":true,"hotkey":true,"preload":"metadata","video":{"url":"https://typoraxmy.oss-cn-shanghai.aliyuncs.com/06d005d8fa336e4df9f64d98ed3183a5.mp4"}});window.dplayers||(window.dplayers=[]);window.dplayers.push(player);})()</script> 
<p>故而数码管需要 <strong>消影</strong></p>
<p>位选—&gt;段选—&gt;位选—&gt;段选—&gt;位选—&gt;段选—&gt;位选—&gt;段选</p>
<p>前一个段选到下一个位选很短的时刻 上一个数据会窜到下一个数据上！！！（段没变 位变了）</p>
<p>所以要</p>
<p>位选—&gt;段选—&gt;<strong>清零</strong>—&gt;位选</p>
<p>但不能立马清零 立马清零数码管会变得比较暗</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;REGX52.H&gt;</span></span><br><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> NixieTable[] = &#123;<span class="hljs-number">0x3F</span>,<span class="hljs-number">0x06</span>,<span class="hljs-number">0x5B</span>,<span class="hljs-number">0x4F</span>,<span class="hljs-number">0x66</span>,<span class="hljs-number">0x6D</span>,<span class="hljs-number">0x7D</span>,<span class="hljs-number">0x07</span>,<span class="hljs-number">0x7F</span>,<span class="hljs-number">0x6F</span>&#125;;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">Delay</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> xms)</span>		<span class="hljs-comment">//@12.000MHz</span><br>&#123;<br>	<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> i, j;<br>	<span class="hljs-keyword">while</span>(xms--)&#123;<br>		i = <span class="hljs-number">2</span>;<br>		j = <span class="hljs-number">239</span>;<br>		<span class="hljs-keyword">do</span><br>		&#123;<br>			<span class="hljs-keyword">while</span> (--j);<br>		&#125; <span class="hljs-keyword">while</span> (--i);<br>	&#125;<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">Nixie</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> location,number)</span>&#123;<br>	<span class="hljs-keyword">switch</span>(location)&#123;<br>		<span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:P2_4=<span class="hljs-number">1</span>;P2_3=<span class="hljs-number">1</span>;P2_2=<span class="hljs-number">1</span>;<span class="hljs-keyword">break</span>;<br>		<span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:P2_4=<span class="hljs-number">1</span>;P2_3=<span class="hljs-number">1</span>;P2_2=<span class="hljs-number">0</span>;<span class="hljs-keyword">break</span>;<br>		<span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:P2_4=<span class="hljs-number">1</span>;P2_3=<span class="hljs-number">0</span>;P2_2=<span class="hljs-number">1</span>;<span class="hljs-keyword">break</span>;<br>		<span class="hljs-keyword">case</span> <span class="hljs-number">4</span>:P2_4=<span class="hljs-number">1</span>;P2_3=<span class="hljs-number">0</span>;P2_2=<span class="hljs-number">0</span>;<span class="hljs-keyword">break</span>;<br>		<span class="hljs-keyword">case</span> <span class="hljs-number">5</span>:P2_4=<span class="hljs-number">0</span>;P2_3=<span class="hljs-number">1</span>;P2_2=<span class="hljs-number">1</span>;<span class="hljs-keyword">break</span>;<br>		<span class="hljs-keyword">case</span> <span class="hljs-number">6</span>:P2_4=<span class="hljs-number">0</span>;P2_3=<span class="hljs-number">1</span>;P2_2=<span class="hljs-number">0</span>;<span class="hljs-keyword">break</span>;<br>		<span class="hljs-keyword">case</span> <span class="hljs-number">7</span>:P2_4=<span class="hljs-number">0</span>;P2_3=<span class="hljs-number">0</span>;P2_2=<span class="hljs-number">1</span>;<span class="hljs-keyword">break</span>;<br>		<span class="hljs-keyword">case</span> <span class="hljs-number">8</span>:P2_4=<span class="hljs-number">0</span>;P2_3=<span class="hljs-number">0</span>;P2_2=<span class="hljs-number">0</span>;<span class="hljs-keyword">break</span>;<br>	&#125;<br>	P0 = NixieTable[number];<br>	Delay(<span class="hljs-number">1</span>);<br>	P0=<span class="hljs-number">0x00</span>;<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br>	<br>	<span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)&#123;<br>		Nixie(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>);<br><span class="hljs-comment">//		Delay(20);</span><br>		Nixie(<span class="hljs-number">2</span>,<span class="hljs-number">2</span>);<br><span class="hljs-comment">//		Delay(20);</span><br>		Nixie(<span class="hljs-number">3</span>,<span class="hljs-number">3</span>);<br><span class="hljs-comment">//		Delay(20);</span><br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/image-20230110221227515.png" srcset="/img/loading.gif" lazyload alt="image-20230110221227515"></p>
<p>数码管驱动方式：</p>
<p><strong>单片机直接扫描</strong>：硬件设备简单，但会耗费大量的单片机CPU时间；</p>
<p><strong>专用驱动芯片</strong>：内部自带显存、扫描电路，单片机只需告诉它显示什么即可 GM1640</p>
<h3 id="1-11模块化编程">1.11模块化编程</h3>
<h4 id="模块化编程">模块化编程</h4>
<p>避免所有函数都放在main函数里</p>
<p>要将不同模块的代码放在不同的c文件里</p>
<p>在.h文件里提供外部可调用函数的声明</p>
<p>预编译：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> __DELAY_H__</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> __DELAY_H__</span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">Delay</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> xms)</span>;<br><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br><br></code></pre></td></tr></table></figure>
<p>•此外还有<code>#ifdef</code>,<code>#if</code>,<code>#else</code>,<code>#elif</code>,<code>#undef</code>等</p>
<p>代码模块化实例</p>
<p><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/image-20230111221933504.png" srcset="/img/loading.gif" lazyload alt="image-20230111221933504"></p>
<blockquote>
<p>include<file>优先到标准库中去搜索模块。</p>
<p>include&quot;file&quot;优先到自定义库中去搜索模块。</p>
</blockquote>
<p><code>main.c</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;REGX52.H&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;Delay.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;Nixie.h&quot;</span></span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br>	<span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)<br>	&#123;<br>		Nixie(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>);<br>		Nixie(<span class="hljs-number">2</span>,<span class="hljs-number">2</span>);<br>		Nixie(<span class="hljs-number">3</span>,<span class="hljs-number">3</span>);<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>Delay.h</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> __DELAY_H__</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> __DELAY_H__</span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">Delay</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> xms)</span>;<br><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br></code></pre></td></tr></table></figure>
<p><code>Delay.c</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">Delay</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> xms)</span>		<span class="hljs-comment">//@12.000MHz</span><br>&#123;<br>	<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> i, j;<br>	<span class="hljs-keyword">while</span>(xms--)&#123;<br>		i = <span class="hljs-number">2</span>;<br>		j = <span class="hljs-number">239</span>;<br>		<span class="hljs-keyword">do</span><br>		&#123;<br>			<span class="hljs-keyword">while</span> (--j);<br>		&#125; <span class="hljs-keyword">while</span> (--i);<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>Nixie.h</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> __NIXIE_H__</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> __NIXIE_H__</span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">Nixie</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> location,number)</span>;<br><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br></code></pre></td></tr></table></figure>
<p><code>Nixie.c</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;REGX52.H&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;Delay.h&quot;</span></span><br><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> NixieTable[] = &#123;<span class="hljs-number">0x3F</span>,<span class="hljs-number">0x06</span>,<span class="hljs-number">0x5B</span>,<span class="hljs-number">0x4F</span>,<span class="hljs-number">0x66</span>,<span class="hljs-number">0x6D</span>,<span class="hljs-number">0x7D</span>,<span class="hljs-number">0x07</span>,<span class="hljs-number">0x7F</span>,<span class="hljs-number">0x6F</span>&#125;;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">Nixie</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> location,number)</span>&#123;<br>	<span class="hljs-keyword">switch</span>(location)&#123;<br>		<span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:P2_4=<span class="hljs-number">1</span>;P2_3=<span class="hljs-number">1</span>;P2_2=<span class="hljs-number">1</span>;<span class="hljs-keyword">break</span>;<br>		<span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:P2_4=<span class="hljs-number">1</span>;P2_3=<span class="hljs-number">1</span>;P2_2=<span class="hljs-number">0</span>;<span class="hljs-keyword">break</span>;<br>		<span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:P2_4=<span class="hljs-number">1</span>;P2_3=<span class="hljs-number">0</span>;P2_2=<span class="hljs-number">1</span>;<span class="hljs-keyword">break</span>;<br>		<span class="hljs-keyword">case</span> <span class="hljs-number">4</span>:P2_4=<span class="hljs-number">1</span>;P2_3=<span class="hljs-number">0</span>;P2_2=<span class="hljs-number">0</span>;<span class="hljs-keyword">break</span>;<br>		<span class="hljs-keyword">case</span> <span class="hljs-number">5</span>:P2_4=<span class="hljs-number">0</span>;P2_3=<span class="hljs-number">1</span>;P2_2=<span class="hljs-number">1</span>;<span class="hljs-keyword">break</span>;<br>		<span class="hljs-keyword">case</span> <span class="hljs-number">6</span>:P2_4=<span class="hljs-number">0</span>;P2_3=<span class="hljs-number">1</span>;P2_2=<span class="hljs-number">0</span>;<span class="hljs-keyword">break</span>;<br>		<span class="hljs-keyword">case</span> <span class="hljs-number">7</span>:P2_4=<span class="hljs-number">0</span>;P2_3=<span class="hljs-number">0</span>;P2_2=<span class="hljs-number">1</span>;<span class="hljs-keyword">break</span>;<br>		<span class="hljs-keyword">case</span> <span class="hljs-number">8</span>:P2_4=<span class="hljs-number">0</span>;P2_3=<span class="hljs-number">0</span>;P2_2=<span class="hljs-number">0</span>;<span class="hljs-keyword">break</span>;<br>	&#125;<br>	P0 = NixieTable[number];<br>	Delay(<span class="hljs-number">1</span>);<br>	P0=<span class="hljs-number">0x00</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>要注意继承问题  在数码管模块里也用到了<code>Delay</code>函数 所以要在模块里引用<code>Delay</code>的头文件</p>
<p>感觉每次调用要复制这些模块到同一个文件夹下面好麻烦</p>
<p>有空的时候要专门做一个自建库 然后修改C51的路径</p>
<h4 id="LCD1602调试">LCD1602调试</h4>
<p>连接好后 数码管会乱码</p>
<p><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/image-20230111223140765.png" srcset="/img/loading.gif" lazyload alt="image-20230111223140765"></p>
<blockquote>
<p>使用LCD1602液晶屏作为调试窗口，提供类似printf函数的功能，可实时观察单片机内部数据的变换情况，便于调试和演示。</p>
<p>只需要知道所提供函数的作用和使用方法</p>
</blockquote>
<p>有报错：</p>
<p><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/image-20230111224227603.png" srcset="/img/loading.gif" lazyload alt="image-20230111224227603"></p>
<p><code>requires ANSI-style prototype</code>搜了一下：</p>
<blockquote>
<p>需要要把调用的子函数放到main前面，或者在main函数前面先把需要调用的子函数定义声明一下。</p>
</blockquote>
<p>也不行</p>
<p>把文件里的函数名字复制过来就好了</p>
<p>然后自己再重新写也好了 好迷惑···</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;REGX52.H&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;LCD1602.h&quot;</span></span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br>	LCD_Init();<br>	LCD_ShowChar(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;A&#x27;</span>);<br>	LCD_ShowString(<span class="hljs-number">1</span>,<span class="hljs-number">3</span>,<span class="hljs-string">&quot;Hello&quot;</span>);<br>	LCD_ShowNum(<span class="hljs-number">1</span>,<span class="hljs-number">9</span>,<span class="hljs-number">123</span>,<span class="hljs-number">3</span>);<br>	LCD_ShowSignedNum(<span class="hljs-number">1</span>,<span class="hljs-number">13</span>,<span class="hljs-number">-66</span>,<span class="hljs-number">1</span>);<br>	LCD_ShowHexNum(<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0xA8</span>,<span class="hljs-number">2</span>);<br>	LCD_ShowBinNum(<span class="hljs-number">2</span>,<span class="hljs-number">4</span>,<span class="hljs-number">0xAA</span>,<span class="hljs-number">8</span>);<br>	<span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)&#123;<br>		<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/a8b8007a5727ab7a0a59d73c9d4f779.jpg" srcset="/img/loading.gif" lazyload alt="a8b8007a5727ab7a0a59d73c9d4f779"></p>
<p>方便地显示字符串/数字：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;REGX52.H&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;LCD1602.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;Delay.h&quot;</span></span><br><br><span class="hljs-type">int</span> result =<span class="hljs-number">0</span>;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br>	LCD_Init();<br>	<span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)&#123;<br>		result++;<br>		Delay(<span class="hljs-number">500</span>);<br>		LCD_ShowNum(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,result,<span class="hljs-number">3</span>);<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<div id="dplayer3" class="dplayer hexo-tag-dplayer-mark" style="margin-bottom: 20px;"></div><script>(function(){var player = new DPlayer({"container":document.getElementById("dplayer3"),"autoplay":true,"hotkey":true,"preload":"metadata","video":{"url":"https://typoraxmy.oss-cn-shanghai.aliyuncs.com/a39a382bfcf654caa8504f6781ca31f9.mp4"}});window.dplayers||(window.dplayers=[]);window.dplayers.push(player);})()</script> 
<h3 id="1-12-矩阵键盘">1.12 矩阵键盘</h3>
<blockquote>
<p>数码管扫描（<strong>输出扫描</strong>）</p>
<p>原理：显示第1位→显示第2位→显示第3位→……，然后快速循环这个过程，最终实现所有数码管同时显示的效果</p>
<p>矩阵键盘扫描（<strong>输入扫描</strong>）</p>
<p>原理：读取第1行(列)→读取第2行(列) →读取第3行(列) → ……，然后快速循环这个过程，最终实现所有按键同时检测的效果</p>
<p>以上两种扫描方式的共性：<strong>节省I/O口</strong></p>
</blockquote>
<h4 id="读取按键显示">读取按键显示</h4>
<h5 id="扫描法">扫描法</h5>
<h6 id="逐行扫描">逐行扫描</h6>
<p><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/image-20230112152213216.png" srcset="/img/loading.gif" lazyload alt="image-20230112152213216"></p>
<p>如果<code>P17,P16,P15,P14</code>全部给高电平1 无论按键按不按下 下面的都是高电平</p>
<p>而将这几个口连接低电平（GND），可以查看<code>P13,12,11,10</code>，如果是0的话说明按键被按下了</p>
<p>所以想要扫描第二行的话只需要将第二行<code>P16</code>置0，其他三行给1，然后判断<code>P13,12,11,10</code></p>
<p>相当于把键盘逐行扫描了一遍</p>
<p>⚠但逐行扫描的话，P15有可能会驱动五线四相步进电机（引脚冲突），导致无源蜂鸣器自己响应，如下图</p>
<p><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/image-20230112152427114.png" srcset="/img/loading.gif" lazyload alt="image-20230112152427114"></p>
<p><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/image-20230112152510088.png" srcset="/img/loading.gif" lazyload alt="image-20230112152510088"></p>
<p>故采用</p>
<h6 id="逐列扫描">逐列扫描</h6>
<p>即给<code>P13,12,11,10</code>进行赋值，读取<code>P17,P16,P15,P14</code></p>
<p><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/image-20230112153239203.png" srcset="/img/loading.gif" lazyload alt="image-20230112153239203"></p>
<p>单片机配置是准双向接口输出配置，当口线输出为1时驱动能力很弱，允许外部装置将其拉低，而当引脚输出为低时，它的驱动能力很强，可吸收相当大的电流。</p>
<p><code>P1，P2，P3</code>都是“弱上拉”，<code>P0</code>是一种开漏输出</p>
<blockquote>
<p>弱上拉:当输出高电平时，能够输出的电流很小，很容易被别的强下拉拉低</p>
<p>开漏输出:输出端相当于三极管的集电极. 高电平状态需要上拉电阻才行.</p>
<p>上拉：将不确定的信号，固定在高电平,电源到器件引脚上的电阻叫上拉电阻，作用是平时使用该引脚为高电平,上拉是对器件注入电流，即灌电流</p>
<p><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/image-20230112154900369.png" srcset="/img/loading.gif" lazyload alt="image-20230112154900369"></p>
<p>下拉:将不确定的信号，固定到地点平,地到器件引脚的电阻叫下拉电阻，作用是平时使该引脚为低电平,下拉是从器件输出电流，即拉电流</p>
<p><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/image-20230112154915834.png" srcset="/img/loading.gif" lazyload alt="image-20230112154915834"></p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/533004907">参考博客</a></p>
<p>💡想在他编程之前创建自建库 呜呜好像要在一个project下 <a target="_blank" rel="noopener" href="https://blog.csdn.net/mcu_rookie/article/details/122435480">类似</a> 下次再看看惹</p>
<p>up主的代码是一条条写下去的 类似这样</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;REGX52.H&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;Delay.h&quot;</span></span><br><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> <span class="hljs-title function_">MatrixKey</span><span class="hljs-params">()</span>&#123;<br>	<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> key=<span class="hljs-number">0</span>;<br>	<br>	P1 = <span class="hljs-number">0xFF</span>;<br>	P1_3 = <span class="hljs-number">0</span>;<br>	<span class="hljs-keyword">if</span>(P1_7 ==<span class="hljs-number">0</span>)&#123;Delay(<span class="hljs-number">20</span>);<span class="hljs-keyword">while</span>(P1_7==<span class="hljs-number">0</span>);<span class="hljs-comment">/*检测松手*/</span>Delay(<span class="hljs-number">20</span>);key=<span class="hljs-number">1</span>;&#125;<br>	<span class="hljs-keyword">if</span>(P1_6==<span class="hljs-number">0</span>)&#123;Delay(<span class="hljs-number">20</span>);<span class="hljs-keyword">while</span>(P1_6==<span class="hljs-number">0</span>);<span class="hljs-comment">/*检测松手*/</span>Delay(<span class="hljs-number">20</span>);key=<span class="hljs-number">5</span>;&#125;<br>	<span class="hljs-keyword">if</span>(P1_5 ==<span class="hljs-number">0</span>)&#123;Delay(<span class="hljs-number">20</span>);<span class="hljs-keyword">while</span>(P1_5==<span class="hljs-number">0</span>);<span class="hljs-comment">/*检测松手*/</span>Delay(<span class="hljs-number">20</span>);key=<span class="hljs-number">9</span>;&#125;<br>	<span class="hljs-keyword">if</span>(P1_4 ==<span class="hljs-number">0</span>)&#123;Delay(<span class="hljs-number">20</span>);<span class="hljs-keyword">while</span>(P1_4==<span class="hljs-number">0</span>);<span class="hljs-comment">/*检测松手*/</span>Delay(<span class="hljs-number">20</span>);key=<span class="hljs-number">13</span>;&#125;<br>	<span class="hljs-comment">//···</span><br><br>	<span class="hljs-keyword">return</span> key;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>感觉有点麻烦 想用循环 参考一个<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44509533/article/details/107823449">博主的代码</a>进行修改和理解</p>
<h6 id="得到扫描法代码：">得到扫描法代码：</h6>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;REGX52.H&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;Delay.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;intrins.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> keyboard P1  <span class="hljs-comment">//四条行线四条列线所连接的IO口，指定标识符keyboard来代替表达式P1</span></span><br><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> <span class="hljs-title function_">MatrixKey</span><span class="hljs-params">()</span><br>&#123;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> row_scan_code=<span class="hljs-number">0x01</span>; <span class="hljs-comment">//行扫描码0000 0001</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> col_scan_code=<span class="hljs-number">0xEF</span>;<span class="hljs-comment">//列扫描码 1110 1110 ;0000 0000</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> keycode;  <span class="hljs-comment">//按键键值</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> i,x,j;<br><span class="hljs-comment">//可以做一个消抖处理</span><br><span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">4</span>;i++)<span class="hljs-comment">//逐列扫描，将列线逐列拉低</span><br>&#123;<br>	keycode=i+<span class="hljs-number">1</span>;<span class="hljs-comment">//对应关键列的第一行</span><br>	keyboard=col_scan_code; <span class="hljs-comment">//P1_3=0-&gt;P1_2=0-&gt;P1_1=0-&gt;P1_0=0按列顺次拉低</span><br>	x=keyboard; <span class="hljs-comment">//读取行线状态</span><br>	<span class="hljs-keyword">for</span>(j=<span class="hljs-number">0</span>;j&lt;<span class="hljs-number">4</span>;j++)<span class="hljs-comment">//逐行扫描</span><br>	&#123;<br>		<span class="hljs-keyword">if</span>(!(x&amp;row_scan_code))<span class="hljs-comment">//说明对应行的按键按下，使行线被拉低</span><br>		&#123;<br>			keycode+=<span class="hljs-number">4</span>*j;<br>			Delay(<span class="hljs-number">20</span>);<br>			<span class="hljs-comment">//如果按键还未释放，则仍有行线被拉至低电平</span><br>			<span class="hljs-keyword">while</span>((keyboard&amp;<span class="hljs-number">0x0f</span>)!=<span class="hljs-number">0x0f</span>);<span class="hljs-comment">//等待按键释放（释放的话低四位是F）</span><br>			Delay(<span class="hljs-number">20</span>);<br>			P1=<span class="hljs-number">0x0F</span>;     <span class="hljs-comment">//恢复原状态，为下次按键做准备</span><br>			<span class="hljs-keyword">return</span> keycode;     <span class="hljs-comment">//已检测到按键键码，返回</span><br>		&#125;<br>		<span class="hljs-keyword">else</span><br>			row_scan_code=_crol_(row_scan_code,<span class="hljs-number">1</span>);<span class="hljs-comment">//左移一位，逐行扫描，将行线逐列拉低</span><br>	&#125;<br>	col_scan_code=_crol_(col_scan_code,<span class="hljs-number">1</span>);<span class="hljs-comment">//左移一位，将下一列线拉低，准备扫描下一列</span><br>	row_scan_code=<span class="hljs-number">0x01</span>;<span class="hljs-comment">//重置行扫描码，为下一行扫描作准备</span><br>&#125;<br>keycode=<span class="hljs-number">0</span>;<span class="hljs-comment">//没有按键按下，键值记为0</span><br><span class="hljs-keyword">return</span> keycode;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><a href="https://gigiboo.github.io/2023/01/12/%E5%8D%95%E7%89%87%E6%9C%BA%E5%87%BD%E6%95%B0/"><code>_crol_</code>函数</a></p>
<p><strong>真实测试后</strong>跳转回来，博主的代码好像和我实际的东西是反的，如果从1开始编号，原始状态的列应该是<code>1111 0111</code>（<code>P1_3~P1_0</code>是低四位），而博主是 <code>1110 1111</code>，是先把<code>P1_4</code>置0了，不过回去看博主是三行四列的键盘，引脚是不一样的，上述代码只改动了行列的问题，未考虑到引脚引出的不同，大意了~重新修改了一下代码如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;REGX52.H&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;Delay.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;intrins.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> keyboard P1  <span class="hljs-comment">//四条行线四条列线所连接的IO口，指定标识符keyboard来代替表达式P1</span></span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief 矩阵键盘读取按键键码</span><br><span class="hljs-comment">  * @param 无</span><br><span class="hljs-comment">  * @retval keycode 按下按键的键码值</span><br><span class="hljs-comment">		如果按键按下不放，程序会停留在此函数，松手的瞬间返回按键键码，没有按键按下时，返回0</span><br><span class="hljs-comment">  */</span><br><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> <span class="hljs-title function_">MatrixKey</span><span class="hljs-params">()</span><br>&#123;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> row_scan_code=<span class="hljs-number">0x80</span>; <span class="hljs-comment">//行扫描码1000 0000 </span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> col_scan_code=<span class="hljs-number">0xF7</span>;<span class="hljs-comment">//列扫描码 1111 0111 ;0000 0000;</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> keycode;  <span class="hljs-comment">//按键键值</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> i,x,j;<br><span class="hljs-comment">//可以做一个消抖处理</span><br><span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">4</span>;i++)<span class="hljs-comment">//逐列扫描，将列线逐列拉低</span><br>&#123;<br>	keycode=i+<span class="hljs-number">1</span>;<span class="hljs-comment">//对应关键列的第一行</span><br>	keyboard=col_scan_code; <span class="hljs-comment">//P1_3=0-&gt;P1_2=0-&gt;P1_1=0-&gt;P1_0=0按列顺次拉低</span><br>	x=keyboard; <span class="hljs-comment">//读取行线状态</span><br>	<span class="hljs-keyword">for</span>(j=<span class="hljs-number">0</span>;j&lt;<span class="hljs-number">4</span>;j++)<span class="hljs-comment">//逐行扫描</span><br>	&#123;<br>		<span class="hljs-keyword">if</span>(!(x&amp;row_scan_code))<span class="hljs-comment">//说明对应行的按键按下，使行线被拉低</span><br>		&#123;<br>			keycode+=<span class="hljs-number">4</span>*j;<br>			Delay(<span class="hljs-number">20</span>);<br>			<span class="hljs-comment">//如果按键还未释放，则仍有行线被拉至低电平</span><br>			<span class="hljs-keyword">while</span>((keyboard&amp;<span class="hljs-number">0xF0</span>)!=<span class="hljs-number">0xF0</span>);<span class="hljs-comment">//等待按键释放（释放的话高四位是F）</span><br>			Delay(<span class="hljs-number">20</span>);<br>			P1=<span class="hljs-number">0xF0</span>;     <span class="hljs-comment">//恢复原状态，为下次按键做准备</span><br>			<span class="hljs-keyword">return</span> keycode;     <span class="hljs-comment">//已检测到按键键码，返回</span><br>		&#125;<br>		<span class="hljs-keyword">else</span><br>			row_scan_code=_cror_(row_scan_code,<span class="hljs-number">1</span>);<span class="hljs-comment">//右移一位，逐行扫描，将行线逐列拉低</span><br>	&#125;<br>	col_scan_code=_cror_(col_scan_code,<span class="hljs-number">1</span>);<span class="hljs-comment">//右移一位，将下一列线拉低，准备扫描下一列</span><br>	row_scan_code=<span class="hljs-number">0x80</span>;<span class="hljs-comment">//重置行扫描码，为下一行扫描作准备</span><br>&#125;<br>keycode=<span class="hljs-number">0</span>;<span class="hljs-comment">//没有按键按下，键值记为0</span><br><span class="hljs-keyword">return</span> keycode;<br>&#125;<br></code></pre></td></tr></table></figure>
<div id="dplayer4" class="dplayer hexo-tag-dplayer-mark" style="margin-bottom: 20px;"></div><script>(function(){var player = new DPlayer({"container":document.getElementById("dplayer4"),"autoplay":true,"hotkey":true,"preload":"metadata","video":{"url":"https://typoraxmy.oss-cn-shanghai.aliyuncs.com/25fe7cf40bdd54d14aeb0075973ccb4a.mp4"}});window.dplayers||(window.dplayers=[]);window.dplayers.push(player);})()</script> 
<p>耶✌</p>
<h5 id="线反法">线反法</h5>
<p>原理：</p>
<blockquote>
<p>首先使P1口的高四位输出高电平，P1口低四位输出低电平，这时键盘的行线被拉高，列线被拉低。如果有按键按下，则某一条行线将被拉低，此时读取P1口高四位，读取到的将不再全为高电平，说明有按键按下。（在判断是否有按键按下这一点上，线反法与逐行逐列扫描法是一致的）根据读取到0值的I/O口所连接的行线，就可以判断出按下的按键位于哪一行。接下来使P1口的高四位输出低电平，P1口低四位输出高电平（即与上次输出的电平相反，因此称为线反法）。如果有按键按下，此时读取P1口低四位，读取到的将不再全为高电平，根据读取到0值的I/O口所连接的列线，就可以判断出按下的按键位于哪一列。综合按键所在的行线与列线，即可唯一确定按键所在位置，进而获取按键的键值。</p>
</blockquote>
<p>第一步：P1.0–P1.3输出为0（4行），P1.4–P1.7做输入（4列）。<br>
第二步：读取P1.4–P1.7的数据并保存。<br>
第三步：将第二步中保存的数据从P1.4–P1.7输出，此时P1.0–P1.3做输入。<br>
第四步：读取P1的数据，若无按键按下，此时读取的数据为0xff，若有按键按下，P1.0–P1.3中必定有一个为0（对应着被按下按键的行），P1.4–P1.7中必定有一个为0（对应着被按下按键的列）。<br>
第五步：依据按键数组查找被按下的按键号。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">//@brief:判断4*4矩阵键盘是否有键可靠按下，高4位口接行线，低四位口接列线</span><br><span class="hljs-comment">//@retval:当有键可靠按下时返回1-16的键值，否则返回0</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> keyboard P1</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> <span class="hljs-title function_">Check_Keydown</span><span class="hljs-params">()</span><br>&#123;<br>	<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> KeyValue=<span class="hljs-number">0</span>;<br>	keyboard=<span class="hljs-number">0x0f</span>;<br>	<span class="hljs-keyword">if</span>(keyboard!=<span class="hljs-number">0x0f</span>)<span class="hljs-comment">//如果按键按下</span><br>	&#123;<br>		delay_ms(<span class="hljs-number">10</span>);<span class="hljs-comment">//延时10ms消抖</span><br>		<span class="hljs-keyword">if</span>(keyboard!=<span class="hljs-number">0x0f</span>)<span class="hljs-comment">//按键确实按下</span><br>		&#123;	<br>			<span class="hljs-comment">//判断按键所在列，以所在列的第一行的按键键值赋给KeyValue</span><br>			keyboard=<span class="hljs-number">0X0F</span>;<br>			<span class="hljs-keyword">switch</span>(keyboard)<br>			&#123;<br>				<span class="hljs-keyword">case</span>(<span class="hljs-number">0X07</span>):	KeyValue=<span class="hljs-number">1</span>;<span class="hljs-keyword">break</span>; <span class="hljs-comment">//第一列按下</span><br>				<span class="hljs-keyword">case</span>(<span class="hljs-number">0X0b</span>):	KeyValue=<span class="hljs-number">2</span>;<span class="hljs-keyword">break</span>; <span class="hljs-comment">//第二列按下</span><br>				<span class="hljs-keyword">case</span>(<span class="hljs-number">0X0d</span>): KeyValue=<span class="hljs-number">3</span>;<span class="hljs-keyword">break</span>; <span class="hljs-comment">//第三列按下</span><br>				<span class="hljs-keyword">case</span>(<span class="hljs-number">0X0e</span>):	KeyValue=<span class="hljs-number">4</span>;<span class="hljs-keyword">break</span>; <span class="hljs-comment">//第四列按下</span><br>			&#125;<br>			<span class="hljs-comment">//判断按键所在行</span><br>			keyboard=<span class="hljs-number">0XF0</span>;<br>			<span class="hljs-keyword">switch</span>(keyboard)<br>			&#123;<br>				<span class="hljs-keyword">case</span>(<span class="hljs-number">0X70</span>):	KeyValue=KeyValue;<span class="hljs-keyword">break</span>;  <span class="hljs-comment">//第一行按下</span><br>				<span class="hljs-keyword">case</span>(<span class="hljs-number">0Xb0</span>):	KeyValue=KeyValue+<span class="hljs-number">4</span>;<span class="hljs-keyword">break</span>;  <span class="hljs-comment">//第二行按下</span><br>				<span class="hljs-keyword">case</span>(<span class="hljs-number">0Xd0</span>): KeyValue=KeyValue+<span class="hljs-number">8</span>;<span class="hljs-keyword">break</span>;  <span class="hljs-comment">//第三行按下</span><br>				<span class="hljs-keyword">case</span>(<span class="hljs-number">0Xe0</span>):	KeyValue=KeyValue+<span class="hljs-number">12</span>;<span class="hljs-keyword">break</span>;  <span class="hljs-comment">//第四行按下</span><br>			&#125;<br>			<span class="hljs-keyword">while</span>(keyboard!=<span class="hljs-number">0xf0</span>); <span class="hljs-comment">//按键松手后退出</span><br>				<span class="hljs-keyword">return</span> KeyValue;<br>		&#125;<br>		<span class="hljs-keyword">else</span>  <span class="hljs-comment">//否则认为是信号干扰导致</span><br>		&#123;<br>			<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;  <span class="hljs-comment">//认为没有按键按下</span><br>		&#125;<br>	&#125;<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;  <span class="hljs-comment">//如果没有按键按下返回零</span><br>&#125;<br></code></pre></td></tr></table></figure>
<p>version2 <a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_45849079/article/details/106888699">参考博主</a>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;REGX51.H&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> SEGPORT P0</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> KEYPORT P1</span><br><br><span class="hljs-keyword">typedef</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> u8;<br><span class="hljs-keyword">typedef</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> u16;<br><br><span class="hljs-comment">//数码管显示按键号，段码</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> code LEDCODE[]=&#123;<span class="hljs-number">0x3f</span>,<span class="hljs-number">0x06</span>,<span class="hljs-number">0x5b</span>,<span class="hljs-number">0x4f</span>,<span class="hljs-number">0x66</span>,<span class="hljs-number">0x6d</span>,<span class="hljs-number">0x7d</span>,<span class="hljs-number">0x07</span>,<span class="hljs-number">0x7f</span>,<span class="hljs-number">0x6f</span>,<span class="hljs-number">0x77</span>,<span class="hljs-number">0x7c</span>,<span class="hljs-number">0x39</span>,<span class="hljs-number">0x5e</span>,<span class="hljs-number">0x79</span>,<span class="hljs-number">0x71</span>,<span class="hljs-number">0x40</span>&#125;;<br><span class="hljs-comment">//查找按键号的数组，行和列与电路图一致</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> KEYCODE[]=<br>&#123;<span class="hljs-number">0XEE</span>,<span class="hljs-number">0XDE</span>,<span class="hljs-number">0XBE</span>,<span class="hljs-number">0X7E</span>,<br> <span class="hljs-number">0XED</span>,<span class="hljs-number">0XDD</span>,<span class="hljs-number">0XBD</span>,<span class="hljs-number">0X7D</span>,<br> <span class="hljs-number">0XEB</span>,<span class="hljs-number">0XDB</span>,<span class="hljs-number">0XBB</span>,<span class="hljs-number">0X7B</span>,<br> <span class="hljs-number">0XE7</span>,<span class="hljs-number">0XD7</span>,<span class="hljs-number">0XB7</span>,<span class="hljs-number">0X77</span>&#125;;<br><br><span class="hljs-comment">//函数声明</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">delayxms</span><span class="hljs-params">(u16 s)</span>;  <span class="hljs-comment">//延时函数</span><br>u8 <span class="hljs-title function_">KEY_Scan</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>;     <span class="hljs-comment">//按键扫描</span><br><br><span class="hljs-comment">//主函数</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">main</span> <span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br> <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)<br> &#123;<br>  SEGPORT=~LEDCODE[KEY_Scan()];<br> &#125;<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">delayxms</span><span class="hljs-params">(u16 s)</span><br>&#123;<br> u16 i,j;<br> <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>;i&lt;s;i++)<br> &#123; <br>  <span class="hljs-keyword">for</span>(j=<span class="hljs-number">0</span>;j&lt;<span class="hljs-number">120</span>;j++)<br>  &#123;&#125;<br> &#125;<br>&#125;<br><br>u8 <span class="hljs-title function_">KEY_Scan</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br> u8 temp,num;<br> KEYPORT=<span class="hljs-number">0xf0</span>;  <span class="hljs-comment">//P1.0--P1.3输出0，P1.4--P1.7输出为1，为输入做准备</span><br> temp=KEYPORT;  <span class="hljs-comment">//读入P1的值</span><br> temp&amp;=<span class="hljs-number">0xf0</span>;    <span class="hljs-comment">//保留P1.4--P1.7的数据</span><br> <span class="hljs-keyword">if</span>(temp!=<span class="hljs-number">0xf0</span>) <span class="hljs-comment">//若P1.4--P1.7输入不全为1，代表有按键被按下</span><br> &#123;<br>  delayxms(<span class="hljs-number">5</span>);  <span class="hljs-comment">//延时消抖</span><br>  KEYPORT=<span class="hljs-number">0xf0</span>; <span class="hljs-comment">//再次判断是否真有按键按下</span><br>  temp=KEYPORT; <span class="hljs-comment">//读入P1的值</span><br>  temp&amp;=<span class="hljs-number">0xf0</span>;   <span class="hljs-comment">//保留P1.4--P1.7的数据</span><br>  <span class="hljs-keyword">if</span>(temp!=<span class="hljs-number">0xf0</span>)  <span class="hljs-comment">//真有按键按下</span><br>  &#123;<br>   temp|=<span class="hljs-number">0x0f</span>;    <br>   KEYPORT=temp; <span class="hljs-comment">//将读取的P1.4--P1.7数据从P1.4--P1.7输出，此时P1.0--P1.3做输入</span><br>   temp=KEYPORT; <span class="hljs-comment">//再次读取P1的值，上述原理中的第四步</span><br>   <span class="hljs-keyword">for</span>(num=<span class="hljs-number">0</span>;num&lt;<span class="hljs-number">16</span>;num++)  <span class="hljs-comment">//查找按键号，</span><br>   &#123;<br>    <span class="hljs-keyword">if</span>(temp==KEYCODE[num])<br>     <span class="hljs-keyword">break</span>;<br>   &#125;<br>   <span class="hljs-keyword">return</span> num;  <span class="hljs-comment">//对应按键号</span><br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">16</span>;   <span class="hljs-comment">//表示无按键按下</span><br> &#125;<br> <span class="hljs-keyword">else</span><br>  <span class="hljs-keyword">return</span> <span class="hljs-number">16</span>;<br>&#125; <br></code></pre></td></tr></table></figure>
<p>version3 <a target="_blank" rel="noopener" href="https://www.cnblogs.com/hughdong/p/6879891.html">参考博主</a>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;reg52.h&gt;</span></span><br><span class="hljs-keyword">typedef</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> uchar;<br><span class="hljs-keyword">typedef</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> uint;<br>uchar code KEY_TABLE[] =<br>&#123;<br>    <span class="hljs-number">0xEE</span>, <span class="hljs-number">0xDE</span>, <span class="hljs-number">0xBE</span>, <span class="hljs-number">0x7E</span>,<br>    <span class="hljs-number">0xED</span>, <span class="hljs-number">0xDD</span>, <span class="hljs-number">0xBD</span>, <span class="hljs-number">0x7D</span>,<br>    <span class="hljs-number">0xEB</span>, <span class="hljs-number">0xDB</span>, <span class="hljs-number">0xBB</span>, <span class="hljs-number">0x7B</span>,<br>    <span class="hljs-number">0xE7</span>, <span class="hljs-number">0xD7</span>, <span class="hljs-number">0xB7</span>, <span class="hljs-number">0x77</span><br>&#125;;<br>uchar code TABLE[] =<br>&#123;<br>    <span class="hljs-number">0x3F</span>, <span class="hljs-number">0x06</span>, <span class="hljs-number">0x5B</span>, <span class="hljs-number">0x4F</span>,<br>    <span class="hljs-number">0x66</span>, <span class="hljs-number">0x6D</span>, <span class="hljs-number">0x7D</span>, <span class="hljs-number">0x07</span>,<br>    <span class="hljs-number">0x7F</span>, <span class="hljs-number">0x6F</span>, <span class="hljs-number">0x77</span>, <span class="hljs-number">0x7C</span>,<br>    <span class="hljs-number">0x39</span>, <span class="hljs-number">0x5E</span>, <span class="hljs-number">0x79</span>, <span class="hljs-number">0x71</span>,<br>&#125;;<br><span class="hljs-type">void</span> <span class="hljs-title function_">Delay</span><span class="hljs-params">(uchar m)</span><br>&#123;<br>    --m;<br>&#125;<br><span class="hljs-type">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    uchar temp, key, i;<br>    <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)<br>    &#123;<br>        P3 = <span class="hljs-number">0xF0</span>;<br>        <span class="hljs-keyword">if</span> (P3 != <span class="hljs-number">0xF0</span>)<br>        &#123;<br>            Delay(<span class="hljs-number">2000</span>);<br>            <span class="hljs-keyword">if</span> (P3 != <span class="hljs-number">0xF0</span>)<br>            &#123;<br>                temp = P3;<br>                P3 = <span class="hljs-number">0x0F</span>;<br>                key = temp | P3;<br>                <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">16</span>; ++i)<br>                    <span class="hljs-keyword">if</span> (key == KEY_TABLE[i])<br>                        <span class="hljs-keyword">break</span>;<br>                P2 = TABLE[i];<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>实现形式有很多 有空的时候对比一下这三个方案 今天单片机花了很久的时间 就先用<a href="#%E5%BE%97%E5%88%B0%E6%89%AB%E6%8F%8F%E6%B3%95%E4%BB%A3%E7%A0%81%EF%BC%9A">扫描法</a>继续推进吧~</p>
<p><code>main.c</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;REGX52.H&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;Delay.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;LCD1602.h&quot;</span></span><br><span class="hljs-meta">#inlcude <span class="hljs-string">&quot;MatrixKey.h&quot;</span></span><br><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> keynumber;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br>	LCD_Init();<br>	<span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)&#123;<br>		keynumber = MatrixKey();<br>		<span class="hljs-keyword">if</span>(keynumber)&#123;<br>			LCD_ShowNum(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,keynumber,<span class="hljs-number">2</span>);<br>		&#125;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>！！得要有<code>if(keynumber)</code>的判断</p>
<p>如果没有的话：1.会显示00 2.按下按键后松开由于进入下一次循环过快会立马刷新为00 无法看清01 会感觉一直是00 所以要判断！！</p>
<h4 id="电子密码锁">电子密码锁</h4>
<p>~矩阵键盘的应用</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;REGX52.H&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;Delay.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;LCD1602.h&quot;</span></span><br><span class="hljs-meta">#inlcude <span class="hljs-string">&quot;MatrixKey.h&quot;</span></span><br><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> keynumber;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> password,count;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> truenumber = <span class="hljs-number">3060</span>;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * S1-S9为对应数字</span><br><span class="hljs-comment">  * S10为对应数字0 </span><br><span class="hljs-comment">  * S11为确认键，S12为取消键</span><br><span class="hljs-comment">  */</span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br>	LCD_Init();<br>	LCD_ShowString(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-string">&quot;Password:&quot;</span>);<br>	<span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)&#123;<br>		keynumber = MatrixKey();<br>		<span class="hljs-comment">//由于while的存在 可以接二连三地往后更新密码 不用担心按键下一次要执行是否会清零的问题</span><br>		<span class="hljs-keyword">if</span>(keynumber)&#123;  <span class="hljs-comment">//输入密码</span><br>			<span class="hljs-keyword">if</span>(keynumber&lt;=<span class="hljs-number">10</span>)&#123;<br>				<span class="hljs-keyword">if</span>(count&lt;<span class="hljs-number">4</span>)&#123;  <span class="hljs-comment">//防止超过int范围</span><br>					password = password*<span class="hljs-number">10</span>+keynumber%<span class="hljs-number">10</span>;  <br>					count++;<br>				&#125;<br>				<span class="hljs-keyword">else</span>&#123;  <span class="hljs-comment">//计次达到4也可以始终读取！</span><br>					<span class="hljs-keyword">if</span>(password&gt;=<span class="hljs-number">1000</span>)&#123;<br>						password = password%(password/<span class="hljs-number">1000</span>*<span class="hljs-number">1000</span>)*<span class="hljs-number">10</span>+keynumber%<span class="hljs-number">10</span>;<br>					&#125;<br>					<span class="hljs-keyword">else</span>&#123;<br>						password = password*<span class="hljs-number">10</span>+keynumber%<span class="hljs-number">10</span>;  <br>					&#125;<br>				&#125;<br>				LCD_ShowNum(<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,password,<span class="hljs-number">4</span>);  <span class="hljs-comment">//更新显示</span><br>			&#125;<br>			<span class="hljs-keyword">if</span>(keynumber==<span class="hljs-number">11</span>)&#123;  <span class="hljs-comment">//确认</span><br>				<span class="hljs-keyword">if</span>(password == truenumber)&#123;<br>					LCD_ShowString(<span class="hljs-number">1</span>,<span class="hljs-number">11</span>,<span class="hljs-string">&quot;   OK!&quot;</span>);<br>				&#125;<br>				<span class="hljs-keyword">else</span>&#123;<br>					LCD_ShowString(<span class="hljs-number">1</span>,<span class="hljs-number">11</span>,<span class="hljs-string">&quot;Wrong!&quot;</span>);<br>					password = <span class="hljs-number">0</span>;<br>					count = <span class="hljs-number">0</span>;<br>					LCD_ShowNum(<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,password,<span class="hljs-number">4</span>);  <span class="hljs-comment">//更新显示</span><br>				&#125;<br>			&#125;<br>			<span class="hljs-keyword">if</span>(keynumber==<span class="hljs-number">12</span>)&#123;  <span class="hljs-comment">//一键清零</span><br>					password = <span class="hljs-number">0</span>;<br>					count = <span class="hljs-number">0</span>;<br>					LCD_ShowNum(<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,password,<span class="hljs-number">4</span>);  <span class="hljs-comment">//更新显示</span><br>			&#125;<br>		&#125;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>由于while的存在 可以接二连三地往后更新密码 不用担心按键下一次要执行是否会清零的问题</p>
<p>但是按到第六位左右会超过int的范围 于是要有预防措施 添加<code>count</code>变量来计次 在up主的功能上多加了一个计次超过4也可以始终不断读取的功能（那这样好像S12就没有用了哦hhh 作为一键清零吧~）</p>
<p>基础上加一个撤销的功能 只删除一个数字 比较简单就不写下去了~</p>
<p>有一个bug 密码不能为0</p>
<p><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/726f76a3a3b9f54837f4be4c8769209.jpg" srcset="/img/loading.gif" lazyload alt="726f76a3a3b9f54837f4be4c8769209"></p>
<div id="dplayer5" class="dplayer hexo-tag-dplayer-mark" style="margin-bottom: 20px;"></div><script>(function(){var player = new DPlayer({"container":document.getElementById("dplayer5"),"autoplay":true,"hotkey":true,"preload":"metadata","video":{"url":"https://typoraxmy.oss-cn-shanghai.aliyuncs.com/9bdf16b92f358a0e8de849a5cf0e20ca.mp4"}});window.dplayers||(window.dplayers=[]);window.dplayers.push(player);})()</script> 
<h4 id="今日总结：">今日总结：</h4>
<p>好家伙！一个矩阵键盘写的字比之前几天加起来的都多！三千多个字 也可能因为代码贴的太多了hhh</p>
<p>一个功能的代码实现可以多样化 耐心尝试与探索 仔细理解 遇到不会的即使搜索相关帖子解决 可以有很大收获</p>
<p>美中不足今天花了好多时间几乎下午三四点开始今天单片机的学习 除了晚饭和饭后散步 一直搞到现在十点</p>
<p>但是今天学习大家有趣的代码以及一些方便的函数 真的会很开心 主动性吸收知识真的很取悦自己</p>
<h3 id="1-14-定时器">1.14 定时器</h3>
<p>独立按键与流水灯的联动！ 直接加在一起的话会有很长时间的delay延迟 用定时器使其灵敏</p>
<p>之前都是单片机控制的L口外部实现的，而定时器属于单片机的内部资源，其电路的连接和运转均在单片机内部完成</p>
<blockquote>
<p>（1）用于计时系统，可实现软件计时，或者使程序每隔一固定时间完成一项操作<br>
（2）替代长时间的Delay，提高CPU的运行效率和处理速度（原来的Delay会耗CPU 效率低）</p>
</blockquote>
<h5 id="定时器内部工作原理">定时器内部工作原理</h5>
<p><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/image-20230114193718207.png" srcset="/img/loading.gif" lazyload alt="image-20230114193718207"></p>
<blockquote>
<p><code>STC89C52</code>的T0和T1四种工作模式：</p>
<p>模式0：13位定时器/计数器</p>
<p><strong>模式1：16位定时器/计数器（常用）</strong></p>
<p>模式2：8位自动重装模式</p>
<p>模式3：两个8位计数器</p>
</blockquote>
<p>以模式1为例</p>
<p><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/image-20230114200130072.png" srcset="/img/loading.gif" lazyload alt="image-20230114200130072"></p>
<p><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/image-20230114201934901.png" srcset="/img/loading.gif" lazyload alt="image-20230114201934901"></p>
<h5 id="中断系统">中断系统</h5>
<p><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/image-20230114203251888.png" srcset="/img/loading.gif" lazyload alt="image-20230114203251888"></p>
<h6 id="流程">流程</h6>
<p><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/image-20230114203555716.png" srcset="/img/loading.gif" lazyload alt="image-20230114203555716"></p>
<h6 id="内部结构图">内部结构图</h6>
<p><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/image-20230114204532170.png" srcset="/img/loading.gif" lazyload alt="image-20230114204532170"></p>
<p>PT0为1 走高优先级 PT0为0 走低优先级</p>
<p>单片机通过<strong>配置寄存器</strong>来控制内部线路的连接—&gt;完善不同的功能</p>
<p><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/image-20230114213718274.png" srcset="/img/loading.gif" lazyload alt="image-20230114213718274"></p>
<p><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/image-20230114213755711.png" srcset="/img/loading.gif" lazyload alt="image-20230114213755711"></p>
<h4 id="中断程序设置">中断程序设置</h4>
<p>应用定时器0</p>
<h5 id="先配置工作模式寄存器TMOD：">先配置工作模式寄存器TMOD：</h5>
<p><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/image-20230114214905474.png" srcset="/img/loading.gif" lazyload alt="image-20230114214905474"></p>
<p>结合流程图👇中的门电路可以看出<code>GATE</code>给<code>0</code>是为了让<code>INT1</code>单独控制 <code>C/T</code>给<code>0</code>是为了工作在计时器模式<code> M1M0</code>给<code>0、1</code>是为了工作在工作模式<code>1</code>（16位）</p>
<p><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/image-20230114215013184.png" srcset="/img/loading.gif" lazyload alt="image-20230114215013184"></p>
<h5 id="接下来配置TCON">接下来配置<code>TCON</code></h5>
<p><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/image-20230114215801600.png" srcset="/img/loading.gif" lazyload alt="image-20230114215801600"></p>
<p>由于<code>gate</code>给了<code>0</code> 所以<code>IE0</code> 和<code>IT0</code>不用配置了</p>
<blockquote>
<p>不可位寻址寄存器只能整体赋值，可位寻址寄存器可以对其中某一位单独赋值</p>
</blockquote>
<h3 id="1-17-定时器（2）">1.17 定时器（2）</h3>
<p>摸鱼了两天+昨天出去玩 停了三天才继续上次的内容，年前应该是跟不完up主的内容了，看大纲轴真的可以很清晰地看出摸鱼的日子，SAD，不要太摆了惹~</p>
<h5 id="接下来配置TH0和TL0">接下来配置<code>TH0</code>和<code>TL0</code></h5>
<p>选了12分频原默认值是：每隔<code>1us</code>+1 计数到最大值（<code>65535</code>）后中断 总定时间为<code>65535us</code></p>
<p>想要实现的目标：每隔1s发生中断，上面的默认达不到1s，所以要不断地累计中断</p>
<p><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/image-20230114220358917.png" srcset="/img/loading.gif" lazyload alt="image-20230114220358917"></p>
<h5 id="配置中断路径">配置中断路径</h5>
<p><a href="#%E5%86%85%E9%83%A8%E7%BB%93%E6%9E%84%E5%9B%BE">具体内部结构图</a></p>
<p><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/image-20230117092124919.png" srcset="/img/loading.gif" lazyload alt="image-20230117092124919"></p>
<p><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/image-20230117092036540.png" srcset="/img/loading.gif" lazyload alt="image-20230117092036540"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c">ET0=<span class="hljs-number">1</span>;<br>EA=<span class="hljs-number">1</span>;<br>PT0=<span class="hljs-number">0</span>;<br></code></pre></td></tr></table></figure>
<h5 id="中断后的程序">中断后的程序</h5>
<p><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/image-20230117092623227.png" srcset="/img/loading.gif" lazyload alt="image-20230117092623227"></p>
<h4 id="test中断程序">test中断程序</h4>
<h5 id="以1ms中断为例子">以1ms中断为例子</h5>
<p>实现手段：赋初值</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;REGX52.H&gt;</span></span><br><br><span class="hljs-comment">/*配置寄存器*/</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">timer0_Init</span><span class="hljs-params">()</span>&#123;<br>	<span class="hljs-comment">/*配置TMOD*/</span><br>	TMOD=<span class="hljs-number">0x01</span>;  <span class="hljs-comment">//0000 0001</span><br>	<span class="hljs-comment">/*配置TCON*/</span><br>	<span class="hljs-comment">/*要求中断要使TF0=1，即TCON_5=1*/</span><br>	<span class="hljs-comment">/*TR=0时禁止计数，即TCON_4=0*/</span><br>	TF0=<span class="hljs-number">0</span>;<br>	TR0=<span class="hljs-number">1</span>;<span class="hljs-comment">//控制是否计数</span><br>	<span class="hljs-comment">/*隔1ms中断*/</span><br>	TH0=<span class="hljs-number">64535</span>/<span class="hljs-number">256</span>;<br>	TL0=<span class="hljs-number">64535</span>%<span class="hljs-number">256</span>;<br>	<span class="hljs-comment">/*配置中断系统*/</span><br>	ET0=<span class="hljs-number">1</span>;<br>	EA=<span class="hljs-number">1</span>;<br>	PT0=<span class="hljs-number">0</span>;<span class="hljs-comment">//默认等于0 低优先级</span><br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br>	timer0_Init();<br>	<span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)&#123;<br>		<br>	&#125;	<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">Timer0_Rountine</span><span class="hljs-params">()</span> interrupt 1&#123;<br>	P2_0=<span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/IMG_2089.JPG" srcset="/img/loading.gif" lazyload alt="IMG_2089"></p>
<h5 id="以1s为目标">以1s为目标</h5>
<p>实现手段：赋初值+循环</p>
<p>注意：计数器溢出后会<code>TH0</code>和<code>TL0</code>会变成0，而不是原来给的初值，所以进入中断要重新赋初值</p>
<p><code>TMOD=0x01;</code>会把定时器1的状态默认刷新为<code>0000</code>，所以要改成<code>TMOD&amp;=0xF0;TMOD|=0X01;</code>，注意不能直接<code>TMOD&amp;=0xF1;</code>如果原来最低位为0的话就不能实现功能</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;REGX52.H&gt;</span></span><br><br><span class="hljs-comment">/*配置寄存器*/</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">timer0_Init</span><span class="hljs-params">()</span>&#123;  <span class="hljs-comment">//1ms @12.000Mhz</span><br><br>	<span class="hljs-comment">/*配置TMOD*/</span><br>	TMOD &amp;= <span class="hljs-number">0xF0</span>; <span class="hljs-comment">//保持高四位，低四位清零</span><br>	TMOD |= <span class="hljs-number">0X01</span>;<br>	<span class="hljs-comment">/*配置TCON*/</span><br>	<span class="hljs-comment">/*要求中断要使TF0=1，即TCON_5=1*/</span><br>	<span class="hljs-comment">/*TR=0时禁止计数，即TCON_4=0*/</span><br>	TF0 = <span class="hljs-number">0</span>;<br>	TR0 = <span class="hljs-number">1</span>;<span class="hljs-comment">//控制是否计数</span><br>	<span class="hljs-comment">/*隔1ms中断*/</span><br>	TH0 = <span class="hljs-number">64535</span>/<span class="hljs-number">256</span>;<br>	TL0 = <span class="hljs-number">64535</span>%<span class="hljs-number">256</span>+<span class="hljs-number">1</span>;<br>	<span class="hljs-comment">/*配置中断系统*/</span><br>	ET0 = <span class="hljs-number">1</span>;<br>	EA = <span class="hljs-number">1</span>;<br>	PT0 = <span class="hljs-number">0</span>;<span class="hljs-comment">//默认等于0 低优先级</span><br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br>	timer0_Init();<br>	<span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)&#123;<br>		<br>	&#125;	<br>&#125;<br><br><span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> count;<br><span class="hljs-type">void</span> <span class="hljs-title function_">Timer0_Rountine</span><span class="hljs-params">()</span> interrupt 1&#123;<br>	TH0 = <span class="hljs-number">64535</span>/<span class="hljs-number">256</span>;<br>	TL0 = <span class="hljs-number">64535</span>%<span class="hljs-number">256</span>;<br>	count++;<br>	<span class="hljs-keyword">if</span>(count&gt;=<span class="hljs-number">1000</span>)&#123;<br>		count = <span class="hljs-number">0</span>;<br>		P2_0 = ~P2_0;<span class="hljs-comment">//会以间隔1s闪烁</span><br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>软件里也有现成的代码配置：</p>
<p><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/image-20230117095057767.png" srcset="/img/loading.gif" lazyload alt="image-20230117095057767"></p>
<p>但是中断系统配置要自己写一下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c">ET0 = <span class="hljs-number">1</span>;<br>EA = <span class="hljs-number">1</span>;<br>PT0 = <span class="hljs-number">0</span>;<br></code></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;REGX52.H&gt;</span></span><br><br><span class="hljs-comment">/*配置寄存器*/</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">timer0_Init</span><span class="hljs-params">()</span>&#123;<br><br><span class="hljs-comment">//	AUXR &amp;= 0x7F;		//定时器时钟12T模式 已经有默认了不需要设置</span><br>	TMOD &amp;= <span class="hljs-number">0xF0</span>;		<span class="hljs-comment">//设置定时器模式</span><br>	TMOD |= <span class="hljs-number">0x01</span>;		<span class="hljs-comment">//设置定时器模式</span><br>	TL0 = <span class="hljs-number">0x18</span>;		<span class="hljs-comment">//设置定时初值</span><br>	TH0 = <span class="hljs-number">0xFC</span>;		<span class="hljs-comment">//设置定时初值</span><br>	TF0 = <span class="hljs-number">0</span>;		<span class="hljs-comment">//清除TF0标志</span><br>	TR0 = <span class="hljs-number">1</span>;		<span class="hljs-comment">//定时器0开始计时</span><br><br>	<span class="hljs-comment">/*配置中断系统*/</span><br>	ET0 = <span class="hljs-number">1</span>;<br>	EA = <span class="hljs-number">1</span>;<br>	PT0 = <span class="hljs-number">0</span>;<span class="hljs-comment">//默认等于0 低优先级</span><br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br>	timer0_Init();<br>	<span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)&#123;<br>		<br>	&#125;	<br>&#125;<br><br><span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> count;<br><span class="hljs-type">void</span> <span class="hljs-title function_">Timer0_Rountine</span><span class="hljs-params">()</span> interrupt 1&#123;<br>	TH0 = <span class="hljs-number">0xFC</span>;<br>	TL0 = <span class="hljs-number">0x18</span>;<br>	count++;<br>	<span class="hljs-keyword">if</span>(count&gt;=<span class="hljs-number">1000</span>)&#123;<br>		count = <span class="hljs-number">0</span>;<br>		P2_0 = ~P2_0;<span class="hljs-comment">//会以间隔1s闪烁</span><br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h5 id="将1s中断程序模块化">将1s中断程序模块化</h5>
<p><code>Timer0.c</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;REGX52.H&gt;</span></span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief  定时器0初始化，1ms 12.000Mhz</span><br><span class="hljs-comment">  * @param  无 </span><br><span class="hljs-comment">  * @retval  无</span><br><span class="hljs-comment">  */</span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">timer0_Init</span><span class="hljs-params">()</span>&#123;<br><br><span class="hljs-comment">//	AUXR &amp;= 0x7F;		//定时器时钟12T模式</span><br>	TMOD &amp;= <span class="hljs-number">0xF0</span>;		<span class="hljs-comment">//设置定时器模式</span><br>	TMOD |= <span class="hljs-number">0x01</span>;		<span class="hljs-comment">//设置定时器模式</span><br>	TL0 = <span class="hljs-number">0x18</span>;		<span class="hljs-comment">//设置定时初值</span><br>	TH0 = <span class="hljs-number">0xFC</span>;		<span class="hljs-comment">//设置定时初值</span><br>	TF0 = <span class="hljs-number">0</span>;		<span class="hljs-comment">//清除TF0标志</span><br>	TR0 = <span class="hljs-number">1</span>;		<span class="hljs-comment">//定时器0开始计时</span><br><br>	<span class="hljs-comment">/*配置中断系统*/</span><br>	ET0 = <span class="hljs-number">1</span>;<br>	EA = <span class="hljs-number">1</span>;<br>	PT0 = <span class="hljs-number">0</span>;<span class="hljs-comment">//默认等于0 低优先级</span><br>&#125;<br><br><span class="hljs-comment">/*定时器中断模板 一般放在main函数中 不易模块化</span><br><span class="hljs-comment">void Timer0_Rountine() interrupt 1&#123;</span><br><span class="hljs-comment">	static unsigned int count;</span><br><span class="hljs-comment">	TH0 = 0xFC;</span><br><span class="hljs-comment">	TL0 = 0x18;</span><br><span class="hljs-comment">	count++;</span><br><span class="hljs-comment">	if(count&gt;=1000)&#123;</span><br><span class="hljs-comment">		count = 0;</span><br><span class="hljs-comment">	&#125;</span><br><span class="hljs-comment">&#125;</span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></table></figure>
<p><code>Timer0.h</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> __Timer0_H__</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> __Timer0_H__</span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">timer0_Init</span><span class="hljs-params">()</span>;<br><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br></code></pre></td></tr></table></figure>
<p><code>main.c</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;REGX52.H&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;Timer0.h&quot;</span></span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br>	timer0_Init();<br>	<span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)&#123;<br>		<br>	&#125;	<br>&#125;<br><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">Timer0_Rountine</span><span class="hljs-params">()</span> interrupt 1&#123;<br>	<span class="hljs-type">static</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> count;<br>	TH0 = <span class="hljs-number">0xFC</span>;<br>	TL0 = <span class="hljs-number">0x18</span>;<br>	count++;<br>	<span class="hljs-keyword">if</span>(count&gt;=<span class="hljs-number">1000</span>)&#123;<br>		count = <span class="hljs-number">0</span>;<br>		P2_0 = ~P2_0;<span class="hljs-comment">//会以间隔1s闪烁</span><br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="按键控制LED流水灯模式">按键控制LED流水灯模式</h4>
<p>获取独立按键的模块化编程：</p>
<p><code>Key.c</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;REGX52.H&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;Delay.h&quot;</span></span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief 获取独立按键键码</span><br><span class="hljs-comment">  * @param 无</span><br><span class="hljs-comment">  * @retval 按键键码0~4，无按键按下时返回值为0</span><br><span class="hljs-comment">  */</span><br><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> <span class="hljs-title function_">key</span><span class="hljs-params">()</span>&#123;<br>	<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> keynumber=<span class="hljs-number">0</span>;<br>	<span class="hljs-keyword">if</span>(P3_1==<span class="hljs-number">0</span>)&#123;Delay(<span class="hljs-number">20</span>);<span class="hljs-keyword">while</span>(P3_1==<span class="hljs-number">0</span>);Delay(<span class="hljs-number">20</span>);keynumber=<span class="hljs-number">1</span>;&#125;<br>	<span class="hljs-keyword">if</span>(P3_0==<span class="hljs-number">0</span>)&#123;Delay(<span class="hljs-number">20</span>);<span class="hljs-keyword">while</span>(P3_0==<span class="hljs-number">0</span>);Delay(<span class="hljs-number">20</span>);keynumber=<span class="hljs-number">2</span>;&#125;		<br>	<span class="hljs-keyword">if</span>(P3_2==<span class="hljs-number">0</span>)&#123;Delay(<span class="hljs-number">20</span>);<span class="hljs-keyword">while</span>(P3_2==<span class="hljs-number">0</span>);Delay(<span class="hljs-number">20</span>);keynumber=<span class="hljs-number">3</span>;&#125;<br>	<span class="hljs-keyword">if</span>(P3_3==<span class="hljs-number">0</span>)&#123;Delay(<span class="hljs-number">20</span>);<span class="hljs-keyword">while</span>(P3_3==<span class="hljs-number">0</span>);Delay(<span class="hljs-number">20</span>);keynumber=<span class="hljs-number">4</span>;&#125;	<br>	<span class="hljs-keyword">return</span> keynumber;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><code>Key.h</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> __Key_H__</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> __Key_H__</span><br><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> <span class="hljs-title function_">key</span><span class="hljs-params">()</span>;<br><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br></code></pre></td></tr></table></figure>
<p>写完模块最好立即测试一下</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;REGX52.H&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;Timer0.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;Key.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;INTRINS.H&gt;</span></span><br><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> keynum,ledmode;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br>	P2 = <span class="hljs-number">0xFE</span>;<br>	timer0_Init();<br>	<span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)&#123;<br>		keynum = key();<br>		<span class="hljs-keyword">if</span>(keynum==<span class="hljs-number">1</span>)&#123;<br>			ledmode++;<br>			<span class="hljs-keyword">if</span>(ledmode&gt;=<span class="hljs-number">2</span>)ledmode = <span class="hljs-number">0</span>;<br>		&#125;<br>	&#125;	<br>&#125;<br><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">Timer0_Rountine</span><span class="hljs-params">()</span> interrupt 1&#123;<br>	<span class="hljs-type">static</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> count;<br>	TH0 = <span class="hljs-number">0xFC</span>;<br>	TL0 = <span class="hljs-number">0x18</span>;<br>	count++;<br>	<span class="hljs-keyword">if</span>(count&gt;=<span class="hljs-number">500</span>)&#123;<br>		count = <span class="hljs-number">0</span>;<br>		<span class="hljs-keyword">if</span>(ledmode==<span class="hljs-number">0</span>)<br>			P2=_crol_(P2,<span class="hljs-number">1</span>);<br>		<span class="hljs-keyword">else</span><br>			P2=_cror_(P2,<span class="hljs-number">1</span>);<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<div id="dplayer6" class="dplayer hexo-tag-dplayer-mark" style="margin-bottom: 20px;"></div><script>(function(){var player = new DPlayer({"container":document.getElementById("dplayer6"),"autoplay":true,"hotkey":true,"preload":"metadata","video":{"url":"https://typoraxmy.oss-cn-shanghai.aliyuncs.com/e953e1340c299756311f62a055a8240c.mp4"}});window.dplayers||(window.dplayers=[]);window.dplayers.push(player);})()</script> 
<h4 id="定时器时钟">定时器时钟</h4>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;REGX52.H&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;Delay.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;LCD1602.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;Timer0.h&quot;</span></span><br><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> Sec,Min,Hour;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br>	LCD_Init();<br>	Timer0_Init();<br>	LCD_ShowString(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-string">&quot;Clock:&quot;</span>);<br>	LCD_ShowString(<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-string">&quot;  :  :&quot;</span>);<br><br>	<span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)&#123;<br>		LCD_ShowNum(<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,Hour,<span class="hljs-number">2</span>);<br>		LCD_ShowNum(<span class="hljs-number">2</span>,<span class="hljs-number">4</span>,Min,<span class="hljs-number">2</span>);<br>		LCD_ShowNum(<span class="hljs-number">2</span>,<span class="hljs-number">7</span>,Sec,<span class="hljs-number">2</span>);<br>	&#125;	<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">Timer0_Rountine</span><span class="hljs-params">()</span> interrupt 1&#123;<br>	<span class="hljs-type">static</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> count;<br>	TH0 = <span class="hljs-number">0xFC</span>;<br>	TL0 = <span class="hljs-number">0x18</span>;<br>	count++;<br>	<span class="hljs-keyword">if</span>(count&gt;=<span class="hljs-number">1000</span>)&#123;<br>		count = <span class="hljs-number">0</span>;<br>		Sec++;<br>		<span class="hljs-keyword">if</span>(Sec&gt;=<span class="hljs-number">60</span>)<br>		&#123;<br>			Sec = <span class="hljs-number">0</span>;<br>			Min++;<br>			<span class="hljs-keyword">if</span>(Min&gt;=<span class="hljs-number">60</span>)<br>			&#123;<br>				Min = <span class="hljs-number">0</span>;<br>				Hour++;<br>				<span class="hljs-keyword">if</span>(Hour&gt;=<span class="hljs-number">24</span>)&#123;<br>					Hour = <span class="hljs-number">0</span>;<br>				&#125;<br>			&#125;<br>		&#125;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<div id="dplayer7" class="dplayer hexo-tag-dplayer-mark" style="margin-bottom: 20px;"></div><script>(function(){var player = new DPlayer({"container":document.getElementById("dplayer7"),"autoplay":true,"hotkey":true,"preload":"metadata","video":{"url":"https://typoraxmy.oss-cn-shanghai.aliyuncs.com/6b34a9a62ab11c9dd7488bcb4dc02961.mp4"}});window.dplayers||(window.dplayers=[]);window.dplayers.push(player);})()</script> 
<p>其他的事情：</p>
<p>关于中断系统up主讲的比较少 要另外找视频再学一下</p>
<p>不能再摸鱼了 剩下还有10个章节 春节前是看不完了 争取在二月前看完哇！</p>
<h3 id="1-18-串口">1.18 串口</h3>
<blockquote>
<p>串口是一种应用十分广泛的<strong>通讯接口</strong>，串口成本低、容易使用、通信线路简单，可实现两个设备的<strong>互相通信</strong>。</p>
<p>单片机的串口可以使单片机与单片机、单片机与电脑、单片机与各式各样的模块互相通信，极大的扩展了单片机的应用范围，增强了单片机系统的硬件实力。</p>
<p>51单片机<strong>内部自带UART</strong>（Universal Asynchronous Receiver Transmitter，<strong>通用异步收发器</strong>），可实现单片机的串口通信。</p>
</blockquote>
<p>单片机-电脑使用usb转换接口</p>
<p><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/image-20230118110540374.png" srcset="/img/loading.gif" lazyload alt="image-20230118110540374"></p>
<p>电平标准：人为规定的电压与数据的对应关系</p>
<blockquote>
<p>TTL电平：+5V表示1，0V表示0 （单片机）</p>
<p>RS232电平：-3-15V表示1，+3~+15V表示0</p>
<p>RS485电平：两线压差+2+6V表示1，-2~-6V表示0（差分信号）</p>
</blockquote>
<table>
<thead>
<tr>
<th><strong>名称</strong></th>
<th><strong>引脚定义</strong></th>
<th><strong>通信方式</strong></th>
<th><strong>特点</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>UART</strong></td>
<td>TXD、RXD</td>
<td><strong>全双工、异步</strong></td>
<td><strong>点对点</strong>通信</td>
</tr>
<tr>
<td>I²C</td>
<td><u>SCL</u>、SDA</td>
<td>半双工、<u>同步</u></td>
<td>可挂载多个设备</td>
</tr>
<tr>
<td>SPI</td>
<td><u>SCLK</u>、MOSI、MISO、CS</td>
<td>全双工、<u>同步</u></td>
<td>可挂载多个设备</td>
</tr>
<tr>
<td>1-Wire</td>
<td>DQ</td>
<td>半双工、异步</td>
<td>可挂载多个设备</td>
</tr>
</tbody>
</table>
<p>I²C    ：单片机写入读出依靠的通信口</p>
<h5 id="通信方式：">通信方式：</h5>
<ol>
<li></li>
</ol>
<ul>
<li>全双工：通信双方可以在<strong>同一时刻</strong>互相传输数据</li>
<li>半双工：通信双方可以互相传输数据，但必须<strong>分时</strong>复用<u>一根</u>数据线</li>
<li>单工：通信只能有一方发送到另一方，不能反向传输（例如：遥控器）</li>
</ul>
<ol start="2">
<li></li>
</ol>
<ul>
<li>异步：通信双方<strong>各自约定</strong>通信速率（双方要自己计时）</li>
<li>同步：通信双方<strong>靠一根时钟线</strong>来约定通信速率</li>
</ul>
<ol start="3">
<li></li>
</ol>
<ul>
<li>总线：<u>连接各个设备</u>的数据传输线路（类似于一条马路，把路边各住户连接起来，使住户可以相互交流）</li>
</ul>
<p>单片机的UART</p>
<p>只有一个，四种工作模式</p>
<p>与电脑的通信接口：</p>
<p><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/image-20230118151951283.png" srcset="/img/loading.gif" lazyload alt="image-20230118151951283"></p>
<p>RXD、TXD（串口）和P3口（IO口）共用</p>
<p>MCU发送信号到usb自动下载电路 转化为usb信号传给电脑（串口通信）</p>
<h5 id="串口参数及时序图">串口参数及时序图</h5>
<p><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/image-20230118153108056.png" srcset="/img/loading.gif" lazyload alt="image-20230118153108056"></p>
<p><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/image-20230118160904942.png" srcset="/img/loading.gif" lazyload alt="image-20230118160904942"></p>
<p>到中断后：</p>
<p><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/image-20230118161202525.png" srcset="/img/loading.gif" lazyload alt="image-20230118161202525"></p>
<h5 id="串口相关寄存器">串口相关寄存器</h5>
<p><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/image-20230118161705814.png" srcset="/img/loading.gif" lazyload alt="image-20230118161705814"></p>
<p>SMOD和SMOD0是属于串口的</p>
<h4 id="串口向电脑发送数据">串口向电脑发送数据</h4>
<h5 id="配置控制寄存器SCON">配置控制寄存器SCON</h5>
<p>应用模式一</p>
<p><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/image-20230118162843820.png" srcset="/img/loading.gif" lazyload alt="image-20230118162843820"></p>
<p><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/image-20230118162954177.png" srcset="/img/loading.gif" lazyload alt="image-20230118162954177"></p>
<h5 id="配置PCON">配置PCON</h5>
<p><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/image-20230118191441248.png" srcset="/img/loading.gif" lazyload alt="image-20230118191441248"></p>
<p>up主说中断不用配置？不太明白欸</p>
<p>似乎是说中断默认打开，相当于已经配置好了，不用自己配置</p>
<h5 id="选择波特率">选择波特率</h5>
<p>串口只能用定时器<strong>1</strong>，且是<strong>8位自动重装载定时器</strong></p>
<p><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/image-20230118192549066.png" srcset="/img/loading.gif" lazyload alt="image-20230118192549066"></p>
<p>用软件的波特率计算器</p>
<p><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/image-20230118194647648.png" srcset="/img/loading.gif" lazyload alt="image-20230118194647648"></p>
<p>要选波特率倍速，波特率加倍是因为分频了</p>
<h5 id="程序">程序</h5>
<p>要发送信息到单片机，需要写信息到缓存SBUF</p>
<p>但<strong>连续发会出错</strong>，所以要通过发送控制器的标志位<code>TI</code>检测</p>
<p>当串行在停止位开始发送时由内部硬件自动置位1，必须由软件来复位</p>
<p><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/image-20230118160904942.png" srcset="/img/loading.gif" lazyload alt="image-20230118160904942"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;REGX52.H&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;Delay.h&quot;</span></span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">UART_Init</span><span class="hljs-params">()</span>&#123;		<span class="hljs-comment">//4800bps@12.000MHz</span><br>	<span class="hljs-comment">/*配置串口部分*/</span><br>	SCON = <span class="hljs-number">0x40</span>;<br>	PCON |= <span class="hljs-number">0x80</span>;<br>	<span class="hljs-comment">/*配置定时器部分*/</span><br>	TMOD &amp;= <span class="hljs-number">0x0F</span>;		<span class="hljs-comment">//设置定时器模式</span><br>	TMOD |= <span class="hljs-number">0x20</span>;		<span class="hljs-comment">//设置定时器模式</span><br>	TL1 = <span class="hljs-number">0xF3</span>;		<span class="hljs-comment">//设定定时初值</span><br>	TH1 = <span class="hljs-number">0xF3</span>;		<span class="hljs-comment">//设定定时器重装值</span><br>	ET1 = <span class="hljs-number">0</span>;        <span class="hljs-comment">//禁止定时器1中断</span><br><span class="hljs-comment">//	TF0 = 0;		//清除TF0标志</span><br><span class="hljs-comment">//	TR0 = 1;		//定时器0开始计时</span><br>	TR1 = <span class="hljs-number">1</span>;		<span class="hljs-comment">//启动定时器1</span><br><br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">UART_SendByte</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> Byte)</span>&#123;<br>	SBUF = Byte; <span class="hljs-comment">//写入缓冲区</span><br>	<span class="hljs-keyword">while</span>(TI==<span class="hljs-number">0</span>);<span class="hljs-comment">//判断是否等于1</span><br>	TI = <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br>	UART_Init();<br>	UART_SendByte(<span class="hljs-number">0x66</span>);<br>	<span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)&#123;<br>		<br>	&#125;	<br>&#125;<br></code></pre></td></tr></table></figure>
<p>打开单片机，发现一直是00，原来是软件的波特率没有改，要改成4800</p>
<p>按照原来的9600的话，发出去一个数据会被采集成两个数据</p>
<p>但是又E6和66交错，可能是因为我的<strong>单片机晶振是11.0596</strong>，修改定时器</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c">TL1 = <span class="hljs-number">0xF4</span>;		<span class="hljs-comment">//设定定时初值</span><br>TH1 = <span class="hljs-number">0xF4</span>;		<span class="hljs-comment">//设定定时器重装值</span><br></code></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;REGX52.H&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;Delay.h&quot;</span></span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">UART_Init</span><span class="hljs-params">()</span>&#123;		<span class="hljs-comment">//4800bps@12.000MHz</span><br>	<span class="hljs-comment">/*配置串口部分*/</span><br>	SCON = <span class="hljs-number">0x40</span>;<br>	PCON |= <span class="hljs-number">0x80</span>;<br>	<span class="hljs-comment">/*配置定时器部分*/</span><br>	TMOD &amp;= <span class="hljs-number">0x0F</span>;		<span class="hljs-comment">//设置定时器模式</span><br>	TMOD |= <span class="hljs-number">0x20</span>;		<span class="hljs-comment">//设置定时器模式</span><br>	TL1 = <span class="hljs-number">0xF4</span>;		<span class="hljs-comment">//设定定时初值</span><br>	TH1 = <span class="hljs-number">0xF4</span>;		<span class="hljs-comment">//设定定时器重装值</span><br>	ET1 = <span class="hljs-number">0</span>;        <span class="hljs-comment">//禁止定时器1中断</span><br><span class="hljs-comment">//	TF0 = 0;		//清除TF0标志</span><br><span class="hljs-comment">//	TR0 = 1;		//定时器0开始计时</span><br>	TR1 = <span class="hljs-number">1</span>;		<span class="hljs-comment">//启动定时器1</span><br><br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">UART_SendByte</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> Byte)</span>&#123;<br>	SBUF = Byte; <span class="hljs-comment">//写入缓冲区</span><br>	<span class="hljs-keyword">while</span>(TI==<span class="hljs-number">0</span>);<span class="hljs-comment">//判断是否等于1</span><br>	TI = <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br>	UART_Init();<br>	UART_SendByte(<span class="hljs-number">0x11</span>);<br>	<span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)&#123;<br>		<br>	&#125;	<br>&#125;<br></code></pre></td></tr></table></figure>
<p>如果把<code>UART_SendByte(0x11);</code>放到while里可能晶振会有误差，可以用以下delay</p>
<h5 id="只发送不接收">只发送不接收</h5>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br>	UART_Init();<br>	<span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)&#123;<br>		UART_SendByte(Sec);<br>		Sec++;<br>		Delay(<span class="hljs-number">1000</span>);<br><br>	&#125;	<br>&#125;<br></code></pre></td></tr></table></figure>
<p><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/image-20230118201728456.png" srcset="/img/loading.gif" lazyload alt="image-20230118201728456"></p>
<h5 id="将串口模块化">将串口模块化</h5>
<p><code>UART.h</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> __UART_H__</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> __UART_H__</span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">UART_Init</span><span class="hljs-params">()</span>;<br><span class="hljs-type">void</span> <span class="hljs-title function_">UART_SendByte</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> Byte)</span>;<br><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br></code></pre></td></tr></table></figure>
<p><code>UART.c</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;REGX52.H&gt;</span></span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief 串口初始化</span><br><span class="hljs-comment">  * @param 无</span><br><span class="hljs-comment">  * @retval 无</span><br><span class="hljs-comment">  */</span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">UART_Init</span><span class="hljs-params">()</span>&#123;		<span class="hljs-comment">//4800bps@11.0596MHz</span><br>	<span class="hljs-comment">/*配置串口部分*/</span><br>	SCON = <span class="hljs-number">0x40</span>;<br>	PCON |= <span class="hljs-number">0x80</span>;<br>	<span class="hljs-comment">/*配置定时器部分*/</span><br>	TMOD &amp;= <span class="hljs-number">0x0F</span>;		<span class="hljs-comment">//设置定时器模式</span><br>	TMOD |= <span class="hljs-number">0x20</span>;		<span class="hljs-comment">//设置定时器模式</span><br>	TL1 = <span class="hljs-number">0xF4</span>;		<span class="hljs-comment">//设定定时初值</span><br>	TH1 = <span class="hljs-number">0xF4</span>;		<span class="hljs-comment">//设定定时器重装值</span><br>	ET1 = <span class="hljs-number">0</span>;        <span class="hljs-comment">//禁止定时器1中断</span><br>	TR1 = <span class="hljs-number">1</span>;		<span class="hljs-comment">//启动定时器1</span><br><br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief 串口发送一个字节数据</span><br><span class="hljs-comment">  * @param Byte 要发送的一个字节数据</span><br><span class="hljs-comment">  * @retval 无</span><br><span class="hljs-comment">  */</span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">UART_SendByte</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> Byte)</span>&#123;<br>	SBUF = Byte; <span class="hljs-comment">//写入缓冲区</span><br>	<span class="hljs-keyword">while</span>(TI==<span class="hljs-number">0</span>);<span class="hljs-comment">//判断是否等于1</span><br>	TI = <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure>
<h4 id="电脑控制LED流水灯">电脑控制LED流水灯</h4>
<p>由于不知道电脑发送信号的时间，所以单片接收需要中断系统，在中断系统中进行数据处理与提取</p>
<p><code>SCON</code>中一个<code>REN</code>（接收位），置1</p>
<p>还要打开串口的中断</p>
<p><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/image-20230118205620282.png" srcset="/img/loading.gif" lazyload alt="image-20230118205620282"></p>
<p><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/image-20230118205901441.png" srcset="/img/loading.gif" lazyload alt="image-20230118205901441"></p>
<p>防止单片机发送数据的时候进入中断，要先做一下测试</p>
<p><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/image-20230118210736914.png" srcset="/img/loading.gif" lazyload alt="image-20230118210736914"></p>
<p>将单片机的信息发送回电脑</p>
<p><img src="https://typoraxmy.oss-cn-shanghai.aliyuncs.com/image-20230118212713998.png" srcset="/img/loading.gif" lazyload alt="image-20230118212713998"></p>
<p><code>UART.c</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;REGX52.H&gt;</span></span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief 串口初始化</span><br><span class="hljs-comment">  * @param 无</span><br><span class="hljs-comment">  * @retval 无</span><br><span class="hljs-comment">  */</span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">UART_Init</span><span class="hljs-params">()</span>&#123;		<span class="hljs-comment">//4800bps@11.0596MHz</span><br>	<span class="hljs-comment">/*配置串口部分*/</span><br>	SCON = <span class="hljs-number">0x50</span>;<br>	PCON |= <span class="hljs-number">0x80</span>;<br>	<span class="hljs-comment">/*配置定时器部分*/</span><br>	TMOD &amp;= <span class="hljs-number">0x0F</span>;		<span class="hljs-comment">//设置定时器模式</span><br>	TMOD |= <span class="hljs-number">0x20</span>;		<span class="hljs-comment">//设置定时器模式</span><br>	TL1 = <span class="hljs-number">0xF4</span>;		<span class="hljs-comment">//设定定时初值</span><br>	TH1 = <span class="hljs-number">0xF4</span>;		<span class="hljs-comment">//设定定时器重装值</span><br>	ET1 = <span class="hljs-number">0</span>;        <span class="hljs-comment">//禁止定时器1中断</span><br>	TR1 = <span class="hljs-number">1</span>;		<span class="hljs-comment">//启动定时器1</span><br>	<span class="hljs-comment">/*配置中断系统*/</span><br>	EA = <span class="hljs-number">1</span>;<br>	ES = <span class="hljs-number">1</span>;<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief 串口发送一个字节数据</span><br><span class="hljs-comment">  * @param Byte 要发送的一个字节数据</span><br><span class="hljs-comment">  * @retval 无</span><br><span class="hljs-comment">  */</span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">UART_SendByte</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> Byte)</span>&#123;<br>	SBUF = Byte; <span class="hljs-comment">//写入缓冲区</span><br>	<span class="hljs-keyword">while</span>(TI==<span class="hljs-number">0</span>);<span class="hljs-comment">//判断是否等于1</span><br>	TI = <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-comment">/*串口中断函数模板</span><br><span class="hljs-comment">void UART_Routine() interrupt 4&#123;</span><br><span class="hljs-comment">	if(RI==1)//防止单片机发送数据的时候进入中断</span><br><span class="hljs-comment">	&#123;	</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">		RI = 0;</span><br><span class="hljs-comment">	&#125;</span><br><span class="hljs-comment">&#125;</span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></table></figure>
<p><code>main.c</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;REGX52.H&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;Delay.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;UART.h&quot;</span></span><br><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> Sec;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;<br>	UART_Init();<br>	<span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)&#123;<br>		<br>	&#125;	<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">UART_Routine</span><span class="hljs-params">()</span> interrupt 4&#123;<br>	<span class="hljs-keyword">if</span>(RI==<span class="hljs-number">1</span>)<span class="hljs-comment">//防止单片机发送数据的时候进入中断</span><br>	&#123;	<br>		RI = <span class="hljs-number">0</span>;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h4 id="计算波特率">计算波特率</h4>
<p>发现选择11.0596MHz后</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c">TL1 = <span class="hljs-number">0xF4</span>;		<span class="hljs-comment">//设定定时初值</span><br>TH1 = <span class="hljs-number">0xF4</span>;		<span class="hljs-comment">//设定定时器重装值</span><br></code></pre></td></tr></table></figure>
<p><code>0xF4</code>是<code>244</code>，每隔<code>256</code>溢出一次，计数值位12，每计数12就溢出一次（每隔12us）</p>
<p>所以定时器的溢出率为1/12us=0.08333Mhz</p>
<p>真正到发送控制器（SMOD为1）的频率为0.08333/16=0.005208Mhz=5208hz</p>
<p>8.33/5200约等于0.16%的误差</p>
<p>如果不选倍数</p>
<p>真正到发送控制器（SMOD为1）的频率为0.08333/2/16=0.002604Mhz=2604hz</p>
<p>也可以让UART发送以编码形式呈现（要转化为ASCII码）</p>
<p>例如发送<code>UART_SendByte(0x41)</code>以编码形式呈现就是<code>A</code></p>
<p>也可以直接发字符<code>UART_SendByte('A')</code></p>
<p>但是如果发送A的时候选的是HEX编码 则是不可见的（在ASCII码中0x0a是不可见的）</p>
<p>（因为这里是8位重整模式，一次给寄存器赋值最高只能存储8位二进制数据，而8位二进制数据正好对应一个字符，所以只能一个一个发送字符）</p>
<p>嗯发现哪止定时器，串口也是很迷糊的，说是郭天祥老师讲的也不错，到时候可以查漏补缺一下┭┮﹏┭┮</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F/" class="category-chain-item">嵌入式</a>
  
  
    <span>></span>
    
  <a href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E5%8D%95%E7%89%87%E6%9C%BA/" class="category-chain-item">单片机</a>
  
  

  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/51%E5%8D%95%E7%89%87%E6%9C%BA/">#51单片机</a>
      
        <a href="/tags/Keil/">#Keil</a>
      
        <a href="/tags/C%E8%AF%AD%E8%A8%80/">#C语言</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>单片机入门学习1</div>
      <div>http://gigiboo.github.io/2023/02/14/单片机1/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Gigiboo</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2023年2月14日</div>
        </div>
      
      
      <div class="license-meta-item">
        <div>许可协议</div>
        <div>
          
            
            
              <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
              <span class="hint--top hint--rounded" aria-label="BY - 署名">
                <i class="iconfont icon-by"></i>
              </span>
              </a>
            
          
        </div>
      </div>
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2023/02/14/%E2%80%9C%E5%8D%95%E7%89%87%E6%9C%BA2%E2%80%9D/" title="单片机入门学习2">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">单片机入门学习2</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2023/01/12/%E5%8D%95%E7%89%87%E6%9C%BA%E5%87%BD%E6%95%B0/" title="单片机遇到的便捷函数">
                        <span class="hidden-mobile">单片机遇到的便捷函数</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  <article id="comments" lazyload>
    
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://lib.baomitu.com/valine/1.4.17/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"h4hltMGcySPe1h9ysuveDQt4-gzGzoHsz","appKey":"FLYP9tULvEQ4yfGsz8b653kE","path":"window.location.pathname","placeholder":null,"avatar":"retro","meta":["nick","mail","link"],"requiredFields":[],"pageSize":10,"lang":"zh-CN","highlight":false,"recordIP":false,"serverURLs":"","emojiCDN":null,"emojiMaps":null,"enableQQ":false,"enable":true},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          var imgSelector = '#valine .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


  </article>


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> <div> Gigiboo's blog | 一些随想与记录</div> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="leancloud-site-pv-container" style="display: none">
        🧐
        <span id="leancloud-site-pv"></span>
        
      </span>
    
    
      <span id="leancloud-site-uv-container" style="display: none">
        👦
        <span id="leancloud-site-uv"></span>
        
      </span>
    
    

  
</div>

  
  
  
<span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span>
<script>
    var now = new Date(); 
    function createtime() { 
        var grt= new Date("07/31/2022 00:00:00");//在此处修改你的建站时间，格式：月/日/年 时:分:秒
        now.setTime(now.getTime()+250); 
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days); 
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours); 
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum); 
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;} 
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum); 
        snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;} 
        document.getElementById("timeDate").innerHTML = "本站已小心翼翼运行 "+dnum+" 天 "; 
        document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒"; 
    } 
setInterval("createtime()",250);
</script>
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      headingSelector : CONFIG.toc.headingSelector || 'h1,h2,h3,h4,h5,h6',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      collapseDepth   : CONFIG.toc.collapseDepth || 0,
      scrollSmooth    : true,
      headingsOffset  : -boardTop
    });
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script defer src="/js/leancloud.js" ></script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
